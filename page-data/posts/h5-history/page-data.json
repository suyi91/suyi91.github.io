{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/h5-history","result":{"data":{"markdownRemark":{"id":"f93642bb-3751-5b55-b5e5-57a77bbb4efd","html":"<h2 id=\"history\" style=\"position:relative;\"><a href=\"#history\" aria-label=\"history permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>history</h2>\n<p>为了可以方便地操作、访问浏览器的历史，浏览器提供了<code class=\"language-text\">window.history</code>对象，通过调用<code class=\"language-text\">go</code>、<code class=\"language-text\">back</code>、<code class=\"language-text\">forward</code>等方法实现浏览器的前进后退。</p>\n<h2 id=\"html5新增内容\" style=\"position:relative;\"><a href=\"#html5%E6%96%B0%E5%A2%9E%E5%86%85%E5%AE%B9\" aria-label=\"html5新增内容 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HTML5新增内容</h2>\n<p>在最新的HTML5标准中，可以操作history栈中的内容。</p>\n<h3 id=\"pushstate\" style=\"position:relative;\"><a href=\"#pushstate\" aria-label=\"pushstate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>pushState</h3>\n<p>在传统的web访问体验中，点击一个新链接会表现为页面的全量加载。但是在HTML5的加持下，可以利用<code class=\"language-text\">pushState</code>实现只修改URL而不全量加载(例如各种各样的单页应用SPA—Single Page Application)，局部更新页面dom加快了访问速度、改善了web体验。</p>\n<p><code class=\"language-text\">pushState</code>使用如下，<code class=\"language-text\">data</code>为存放到history栈的数据，<code class=\"language-text\">title</code>是网页的标题，<code class=\"language-text\">url</code>是浏览器地址栏需要展示的地址。使用<code class=\"language-text\">pushState</code>跳转的页面会添加历史。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">history<span class=\"token punctuation\">.</span><span class=\"token function\">pushState</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p><em>注意:</em></p>\n<ol>\n<li>经测试chrome/ff下title参数设置无效，需要使用<code class=\"language-text\">document.title = xxx</code>进行修改。</li>\n<li>pushState传入的url需同域，否则浏览器会抛出错误。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b536176d23656987635882da5d879c93/66632/pushState-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.702127659574469%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAe0lEQVQI1y2KWw6CMBQF2f/iBHkmVoI2FSJSaIFYIh/jNfhxMucVrcbg6xqvFGNV4bQmtA/eV8Um3a4u7LcG+idYe3AYDv274BxD1/FZF6Kg7/gkZo5PrOmZRfyUpeg8oy1ynNBJdmmCLwus7KPISp5+lE8ju6lKtlfPF9zTkrynsXg5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/b536176d23656987635882da5d879c93/8ac56/pushState-error.webp 240w,\n/static/b536176d23656987635882da5d879c93/d3be9/pushState-error.webp 480w,\n/static/b536176d23656987635882da5d879c93/e46b2/pushState-error.webp 960w,\n/static/b536176d23656987635882da5d879c93/f992d/pushState-error.webp 1440w,\n/static/b536176d23656987635882da5d879c93/ca108/pushState-error.webp 1504w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/b536176d23656987635882da5d879c93/8ff5a/pushState-error.png 240w,\n/static/b536176d23656987635882da5d879c93/e85cb/pushState-error.png 480w,\n/static/b536176d23656987635882da5d879c93/d9199/pushState-error.png 960w,\n/static/b536176d23656987635882da5d879c93/07a9c/pushState-error.png 1440w,\n/static/b536176d23656987635882da5d879c93/66632/pushState-error.png 1504w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/b536176d23656987635882da5d879c93/d9199/pushState-error.png\"\n          alt=\"pushState error\"\n          title=\"pushState error\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></li>\n</ol>\n</blockquote>\n<h3 id=\"replacestate\" style=\"position:relative;\"><a href=\"#replacestate\" aria-label=\"replacestate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>replaceState</h3>\n<p>修改当前历史，不添加新历史。使用同<code class=\"language-text\">pushState</code>。</p>\n<h3 id=\"popstate\" style=\"position:relative;\"><a href=\"#popstate\" aria-label=\"popstate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>popstate</h3>\n<p>当浏览历史发生改变时，会触发<code class=\"language-text\">popstate</code>事件。如果是<code class=\"language-text\">pushState</code>/<code class=\"language-text\">replaceState</code>创建的历史，<code class=\"language-text\">popstate</code>触发时可以获取到<code class=\"language-text\">pushState</code>/<code class=\"language-text\">replaceState</code>调用时的第一个参数<code class=\"language-text\">data</code>的数据拷贝。下面是一个简单的例子，模拟了<code class=\"language-text\">pushState</code>和<code class=\"language-text\">popstate</code>的使用。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>forward<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>前进<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>backward<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>后退<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">let</span> count <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'forward'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      history<span class=\"token punctuation\">.</span><span class=\"token function\">pushState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> count <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'count: '</span> <span class=\"token operator\">+</span> count<span class=\"token punctuation\">,</span> <span class=\"token string\">'?count='</span> <span class=\"token operator\">+</span> count<span class=\"token punctuation\">)</span>\n      count <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'backward'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n      count <span class=\"token operator\">-=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n      history<span class=\"token punctuation\">.</span><span class=\"token function\">back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'popstate'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><code class=\"language-text\">popstate</code>的数据可以直接从回调的事件中获取<code class=\"language-text\">event.state</code>。当然，也可以直接调用<code class=\"language-text\">history.state</code>获取当前历史中存放的数据。</p>\n<h2 id=\"location\" style=\"position:relative;\"><a href=\"#location\" aria-label=\"location permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>location</h2>\n<p>谈到<code class=\"language-text\">history</code>必然离不开<code class=\"language-text\">location</code>，这边简单介绍一下location。</p>\n<h3 id=\"类型说明\" style=\"position:relative;\"><a href=\"#%E7%B1%BB%E5%9E%8B%E8%AF%B4%E6%98%8E\" aria-label=\"类型说明 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>类型说明</h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// location的TS定义</span>\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Location</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * Returns a DOMStringList object listing the origins of the ancestor browsing contexts, from the parent browsing context to the top-level browsing context.\n   */</span>\n  <span class=\"token keyword\">readonly</span> ancestorOrigins<span class=\"token operator\">:</span> DOMStringList<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Returns the Location object's URL's fragment (includes leading \"#\" if non-empty).\n   *\n   * Can be set, to navigate to the same URL with a changed fragment (ignores leading \"#\").\n   */</span>\n  hash<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Returns the Location object's URL's host and port (if different from the default port for the scheme).\n   *\n   * Can be set, to navigate to the same URL with a changed host and port.\n   */</span>\n  host<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Returns the Location object's URL's host.\n   *\n   * Can be set, to navigate to the same URL with a changed host.\n   */</span>\n  hostname<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Returns the Location object's URL.\n   *\n   * Can be set, to navigate to the given URL.\n   */</span>\n  href<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Returns the Location object's URL's origin.\n   */</span>\n  <span class=\"token keyword\">readonly</span> origin<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Returns the Location object's URL's path.\n   *\n   * Can be set, to navigate to the same URL with a changed path.\n   */</span>\n  pathname<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Returns the Location object's URL's port.\n   *\n   * Can be set, to navigate to the same URL with a changed port.\n   */</span>\n  port<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Returns the Location object's URL's scheme.\n   *\n   * Can be set, to navigate to the same URL with a changed scheme.\n   */</span>\n  protocol<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Returns the Location object's URL's query (includes leading \"?\" if non-empty).\n   *\n   * Can be set, to navigate to the same URL with a changed query (ignores leading \"?\").\n   */</span>\n  search<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Navigates to the given URL.\n   */</span>\n  <span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Reloads the current page.\n   */</span>\n  <span class=\"token function\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/** @deprecated */</span>\n  <span class=\"token function\">reload</span><span class=\"token punctuation\">(</span>forcedReload<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Removes the current page from the session history and navigates to the given URL.\n   */</span>\n  <span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"location中属性说明\" style=\"position:relative;\"><a href=\"#location%E4%B8%AD%E5%B1%9E%E6%80%A7%E8%AF%B4%E6%98%8E\" aria-label=\"location中属性说明 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>location中属性说明</h3>\n<p>下面举MDN上面的例子介绍<code class=\"language-text\">location</code>的属性。</p>\n<p><code class=\"language-text\">http://example.com:8888/foo/bar?q=baz#bang</code>对应location中的各个部分。</p>\n<table>\n<thead>\n<tr>\n<th>属性</th>\n<th align=\"center\">内容</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">href</code></td>\n<td align=\"center\"><code class=\"language-text\">http://example.com:8888/foo/bar?q=baz#bang</code></td>\n<td></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">origin</code></td>\n<td align=\"center\"><code class=\"language-text\">http://example.com:8888</code></td>\n<td><code class=\"language-text\">protocal</code> + <code class=\"language-text\">hostname</code> + <code class=\"language-text\">port</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">protocal</code></td>\n<td align=\"center\"><code class=\"language-text\">http:</code></td>\n<td></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">host</code></td>\n<td align=\"center\"><code class=\"language-text\">example.com:8888</code></td>\n<td></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">hostname</code></td>\n<td align=\"center\"><code class=\"language-text\">example.com</code></td>\n<td></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">port</code></td>\n<td align=\"center\"><code class=\"language-text\">8888</code></td>\n<td></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">pathname</code></td>\n<td align=\"center\"><code class=\"language-text\">/foo/bar</code></td>\n<td></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">search</code></td>\n<td align=\"center\"><code class=\"language-text\">?q=baz</code></td>\n<td></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">hash</code></td>\n<td align=\"center\"><code class=\"language-text\">#bang</code></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p><code class=\"language-text\">location</code>中还有一个只读属性<code class=\"language-text\">ancestorOrigins</code>，在iframe中可获取外部父页面的域名信息(可用来判断当前文档在iframe中)。</p>\n<h3 id=\"location中方法使用\" style=\"position:relative;\"><a href=\"#location%E4%B8%AD%E6%96%B9%E6%B3%95%E4%BD%BF%E7%94%A8\" aria-label=\"location中方法使用 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>location中方法使用</h3>\n<blockquote>\n<p>如果不需要HTML5 History存储对象，直接使用<code class=\"language-text\">location</code>的API也可实现页面历史操作。</p>\n<p>并且，<code class=\"language-text\">location</code>使用时没有同域的限制。</p>\n</blockquote>\n<ol>\n<li>\n<p><code class=\"language-text\">assign</code></p>\n<p><code class=\"language-text\">location.assign(url)</code>作用等同于<code class=\"language-text\">location = url</code>(也可以<code class=\"language-text\">location.href = url</code>、<code class=\"language-text\">location.hash = xxx</code>等直接赋值)。</p>\n</li>\n<li>\n<p><code class=\"language-text\">reload</code></p>\n<p>页面刷新。</p>\n</li>\n<li>\n<p><code class=\"language-text\">replace</code></p>\n<p>当前页面地址重定向访问。</p>\n</li>\n</ol>\n<h2 id=\"vue-router\" style=\"position:relative;\"><a href=\"#vue-router\" aria-label=\"vue router permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vue-router</h2>\n<p>最近在看<code class=\"language-text\">Vue-router</code>的实现代码，文章最后就简单介绍一下路由导航的实现。</p>\n<h3 id=\"初始化\" style=\"position:relative;\"><a href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96\" aria-label=\"初始化 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>初始化</h3>\n<p>vue项目使用<code class=\"language-text\">Vue-router</code>时，都会使用<code class=\"language-text\">new VueRouter({ routes })</code>的形式构建出可供Vue实例读取的Router对象。</p>\n<p><code class=\"language-text\">new</code>操作相应的源码就是<a href=\"https://sourcegraph.com/github.com/vuejs/vue-router@f0d9c2d93cf06b5b2202bd77df6281cf47970b20/-/blob/src/index.js#L36\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Link</a>。</p>\n<h3 id=\"路由模式\" style=\"position:relative;\"><a href=\"#%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F\" aria-label=\"路由模式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>路由模式</h3>\n<p><code class=\"language-text\">Vue-router</code>有三种路由模式: <code class=\"language-text\">history</code>、<code class=\"language-text\">hash</code>、<code class=\"language-text\">abstract</code>。</p>\n<ol>\n<li>\n<p><code class=\"language-text\">history</code></p>\n<p>这个模式使用<code class=\"language-text\">history.pushState</code>作为历史切换的方式，URL比较正常例如<code class=\"language-text\">http://example.com/dir/subdir</code>。</p>\n<p>对应源码是<a href=\"https://sourcegraph.com/github.com/vuejs/vue-router@f0d9c2d93cf06b5b2202bd77df6281cf47970b20/-/blob/src/history/html5.js#L10:1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">HTML5History类</a></p>\n<p>但是使用时需要注意的是，因为浏览器url访问的规则，例如<code class=\"language-text\">http://example.com/dir/subdir</code>会访问服务器路径<code class=\"language-text\">/dir/subdir</code>的文件(<code class=\"language-text\">subdir.html</code>、<code class=\"language-text\">subdir/index.html</code>或同路径服务等等)，对于单页应用来说这个路径并没有相应的文件。所以需要在服务端配置路径访问404时返回单页应用的<code class=\"language-text\">index.html</code>文件。</p>\n</li>\n<li>\n<p><code class=\"language-text\">hash</code></p>\n<p>这个模式使用<code class=\"language-text\">location</code>的<code class=\"language-text\">hash</code>作为单页应用各个路由的访问路径(例如<code class=\"language-text\">http://example.com/dir/#/spaRoute</code>)。比较简单，不需要服务端额外的404配置。</p>\n<p>对应的源码是<a href=\"https://sourcegraph.com/github.com/vuejs/vue-router@f0d9c2d93cf06b5b2202bd77df6281cf47970b20/-/blob/src/history/hash.js#L10\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">HashHistory类</a>。浏览器路由事件的监听使用了<code class=\"language-text\">popstate</code>或<code class=\"language-text\">hashchange</code>(支持HTML5 History就用<code class=\"language-text\">popstate</code>，否则使用<code class=\"language-text\">hashchange</code>)。</p>\n</li>\n<li>\n<p><code class=\"language-text\">abstract</code></p>\n<p>这个模式通常给<code class=\"language-text\">nodejs</code>服务端使用(比如服务端渲染<code class=\"language-text\">SSR</code>)，可以模拟浏览器端的历史切换。如果<code class=\"language-text\">Vue-router</code>运行时的环境不支持浏览器的API，会直接设置成<code class=\"language-text\">abstract</code>模式。</p>\n<p>对应的源码是<a href=\"https://sourcegraph.com/github.com/vuejs/vue-router@f0d9c2d93cf06b5b2202bd77df6281cf47970b20/-/blob/src/history/abstract.js#L8:14\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AbstractHistory类</a></p>\n</li>\n</ol>\n<h3 id=\"路由动作\" style=\"position:relative;\"><a href=\"#%E8%B7%AF%E7%94%B1%E5%8A%A8%E4%BD%9C\" aria-label=\"路由动作 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>路由动作</h3>\n<p>在上面的三种模式中，路由对象都继承了基类<a href=\"https://sourcegraph.com/github.com/vuejs/vue-router@f0d9c2d93cf06b5b2202bd77df6281cf47970b20/-/blob/src/history/base.js#L22:1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">History</a>并模拟实现了类似浏览器location API的<code class=\"language-text\">go</code>、<code class=\"language-text\">push</code>、<code class=\"language-text\">replace</code>方法。</p>\n<p>同时，<code class=\"language-text\">history</code>和<code class=\"language-text\">hash</code>模式下监听了浏览器的<code class=\"language-text\">popstate</code>、<code class=\"language-text\">hashchange</code>等事件，在浏览器前进/后退操作时更新SPA。</p>","fields":{"slug":"/posts/h5-history","tagSlugs":["/tag/javascript/","/tag/html-5/","/tag/vue-router/"]},"frontmatter":{"date":"2020-06-25 22:00","description":"History Api在HTML5时代，增加了一些特性，值得了解学习。","tags":["javascript","html5","vue-router"],"title":"HTML5 History & Location & Vue-router简单实现","socialImage":""}}},"pageContext":{"slug":"/posts/h5-history"}}}