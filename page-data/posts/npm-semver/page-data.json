{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/npm-semver","result":{"data":{"markdownRemark":{"id":"e828c349-c84d-5906-8d13-64e051166b23","html":"<p>讲到前端，绕不开<code class=\"language-text\">npm</code>。作为前端包管理工具，<code class=\"language-text\">npm</code>的版本管理也遵循<a href=\"https://semver.org/lang/zh-CN/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">semantic version</a>。</p>\n<h2 id=\"npm包的版本\" style=\"position:relative;\"><a href=\"#npm%E5%8C%85%E7%9A%84%E7%89%88%E6%9C%AC\" aria-label=\"npm包的版本 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>npm包的版本</h2>\n<p>npm包的版本定义在<code class=\"language-text\">package.json</code>中的<code class=\"language-text\">version</code>字段中，发布新版本时可以升级<code class=\"language-text\">major</code>、<code class=\"language-text\">minor</code>、<code class=\"language-text\">patch</code>等，数字的升级规则可见前文。</p>\n<p>包一般都需要用到很多的第三方依赖包，依赖包定义在<code class=\"language-text\">package.json</code>的<code class=\"language-text\">dependencies</code>或<code class=\"language-text\">devDependencies</code>中。</p>\n<h3 id=\"依赖版本中符号的意义\" style=\"position:relative;\"><a href=\"#%E4%BE%9D%E8%B5%96%E7%89%88%E6%9C%AC%E4%B8%AD%E7%AC%A6%E5%8F%B7%E7%9A%84%E6%84%8F%E4%B9%89\" aria-label=\"依赖版本中符号的意义 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>依赖版本中符号的意义</h3>\n<ol>\n<li>\n<p><code class=\"language-text\">^</code> 包含相同<code class=\"language-text\">major</code>版本中所有大于指定版本的版本</p>\n<blockquote>\n<p>例如: <code class=\"language-text\">1.10.0</code>满足<code class=\"language-text\">^1.2.3</code>但是<code class=\"language-text\">2.0.0</code>不满足</p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">~</code> 包含相同<code class=\"language-text\">major</code>和<code class=\"language-text\">minor</code>版本中所有大于指定版本的版本</p>\n<blockquote>\n<p>例如: <code class=\"language-text\">1.2.5</code>满足<code class=\"language-text\">~1.2.3</code>但是<code class=\"language-text\">1.10.0</code>不满足</p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">&gt;</code> <code class=\"language-text\">&lt;</code>, <code class=\"language-text\">=</code>, <code class=\"language-text\">&gt;=</code>, <code class=\"language-text\">&lt;=</code>版本比较符号，和各自的数学意义一致。</p>\n<blockquote>\n<p>例如: <code class=\"language-text\">2.0.0</code>满足<code class=\"language-text\">&gt;1.2.3</code>但是<code class=\"language-text\">1.2.0</code>不满足</p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">-</code> 用来连接两个版本，<code class=\"language-text\">-</code>两侧必须要有空格</p>\n<blockquote>\n<p>例如: <code class=\"language-text\">2.0.1</code>满足<code class=\"language-text\">2.0.0 - 2.0.2</code></p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">||</code> “或” 连接左右两侧的判断</p>\n<blockquote>\n<p>例如: <code class=\"language-text\">2.1.0</code>和<code class=\"language-text\">2.3.1</code>均满足<code class=\"language-text\">^2 &lt;2.2 || &gt; 2.3</code></p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">*</code>/<code class=\"language-text\">x</code>/<code class=\"language-text\">X</code> 表示所在位置可以为任意值</p>\n<blockquote>\n<p>例如: <code class=\"language-text\">1.2.3</code>满足<code class=\"language-text\">1.2.x</code></p>\n</blockquote>\n</li>\n</ol>\n<h3 id=\"版本管理库----semver\" style=\"position:relative;\"><a href=\"#%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%BA%93----semver\" aria-label=\"版本管理库    semver permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>版本管理库 — semver</h3>\n<p><code class=\"language-text\">semver</code>是npm中很强大的<a href=\"https://github.com/npm/node-semver\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">库</a>，可以方便的操作、比较版本字符串。同时，也是npm正在使用的semver解析工具。</p>\n<p>以下摘取github中部分的api使用sample。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> semver <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'semver'</span><span class=\"token punctuation\">)</span>\n\nsemver<span class=\"token punctuation\">.</span><span class=\"token function\">valid</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1.2.3'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// '1.2.3'</span>\nsemver<span class=\"token punctuation\">.</span><span class=\"token function\">valid</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a.b.c'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// null</span>\nsemver<span class=\"token punctuation\">.</span><span class=\"token function\">clean</span><span class=\"token punctuation\">(</span><span class=\"token string\">'  =v1.2.3   '</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// '1.2.3'</span>\nsemver<span class=\"token punctuation\">.</span><span class=\"token function\">satisfies</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1.2.3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1.x || >=2.5.0 || 5.0.0 - 7.2.3'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\nsemver<span class=\"token punctuation\">.</span><span class=\"token function\">gt</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1.2.3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'9.8.7'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span>\nsemver<span class=\"token punctuation\">.</span><span class=\"token function\">lt</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1.2.3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'9.8.7'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\nsemver<span class=\"token punctuation\">.</span><span class=\"token function\">minVersion</span><span class=\"token punctuation\">(</span><span class=\"token string\">'>=1.0.0'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// '1.0.0'</span>\nsemver<span class=\"token punctuation\">.</span><span class=\"token function\">valid</span><span class=\"token punctuation\">(</span>semver<span class=\"token punctuation\">.</span><span class=\"token function\">coerce</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// '2.0.0'</span>\nsemver<span class=\"token punctuation\">.</span><span class=\"token function\">valid</span><span class=\"token punctuation\">(</span>semver<span class=\"token punctuation\">.</span><span class=\"token function\">coerce</span><span class=\"token punctuation\">(</span><span class=\"token string\">'42.6.7.9.3-alpha'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// '42.6.7'</span></code></pre></div>\n<h3 id=\"npm相关的版本命令\" style=\"position:relative;\"><a href=\"#npm%E7%9B%B8%E5%85%B3%E7%9A%84%E7%89%88%E6%9C%AC%E5%91%BD%E4%BB%A4\" aria-label=\"npm相关的版本命令 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>npm相关的版本命令</h3>\n<p>npm-cli有一个命令<code class=\"language-text\">version</code>，可以查看包版本和设置版本(写入<code class=\"language-text\">package.json</code>/<code class=\"language-text\">package-lock.json</code>，如果存在<code class=\"language-text\">npm-shrinkwrap.json</code>也将写入)。</p>\n<ol>\n<li><code class=\"language-text\">npm version &lt;newversion&gt;</code> 将版本设置为<code class=\"language-text\">&lt;newversion&gt;</code>，<code class=\"language-text\">&lt;newversion&gt;</code>必须符合semver规范</li>\n<li><code class=\"language-text\">npm version [major | minor | patch]</code> 根据输入的内容，将版本的对应部分 + 1，取得新版本并写入项目。</li>\n<li>\n<p><code class=\"language-text\">npm version [premajor | preminor | prepatch]</code> 根据输入的内容，将版本的对应部分预发布版本 + 1，取得新版本并写入项目。</p>\n<blockquote>\n<p><code class=\"language-text\">0.0.0</code>经过<code class=\"language-text\">premajor</code>后得到<code class=\"language-text\">1.0.0-0</code></p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">npm version prerelease [--preid=&lt;prerelease-id&gt;]</code> 生成新的预发布版本(如果已经是正式版本，则得到新的<code class=\"language-text\">prepatch</code>版本)。<code class=\"language-text\">preid</code>为阶段id，例如<code class=\"language-text\">beta</code>/<code class=\"language-text\">alpha</code>等等。</p>\n<blockquote>\n<p><code class=\"language-text\">1.0.0</code>经过<code class=\"language-text\">prerelease</code>后得到<code class=\"language-text\">1.0.1-0</code></p>\n<p><code class=\"language-text\">1.0.0</code>经过<code class=\"language-text\">prerelease --preid=beta</code>后得到<code class=\"language-text\">1.0.1-beta.0</code>，再次<code class=\"language-text\">prerelease --preid=beta</code>后得到<code class=\"language-text\">1.0.1-beta.1</code></p>\n</blockquote>\n</li>\n</ol>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ol>\n<li><a href=\"https://semver.npmjs.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">npm语义化版本计算器</a></li>\n<li><a href=\"https://docs.npmjs.com/cli/version\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">npm version说明</a></li>\n</ol>","fields":{"slug":"/posts/npm-semver","tagSlugs":["/tag/npm/","/tag/semver/","/tag/前端/","/tag/node/"]},"frontmatter":{"date":"2020-03-13 22:00","description":null,"tags":["npm","semver","前端","node"],"title":"npm中的semver","socialImage":"semver.jpg"}}},"pageContext":{"slug":"/posts/npm-semver"}}}