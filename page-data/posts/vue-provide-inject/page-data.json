{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/vue-provide-inject","result":{"data":{"markdownRemark":{"id":"a8bb5255-d7f4-51b8-8d32-37ce0146c5f5","html":"<p>æœ€è¿‘åœ¨å·¥ä½œä¸­ï¼Œè¢«ä¸€ä¸ªåŒäº‹é—®åˆ°äº†provide/injectçš„ç”¨æ³•ã€‚è¿™ä¸ç®€å•å˜›ï¼Œå½“å³ç»™å‡ºç­”æ¡ˆå¤§è‡´å¦‚ä¸‹ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ç¥–å…ˆç»„ä»¶</span>\n  <span class=\"token function-variable function\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    prop1<span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">provide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      prop1<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prop1\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// å­å­™ç»„ä»¶</span>\n  inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'prop1'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>è¿‡äº†ä¼šå„¿åŒäº‹åˆæ¥æ‰¾æˆ‘: <em>â€œprop1çš„å“åº”å¼æ²¡äº†â€¦â€</em>ã€‚æ­¤æ—¶æ‰å›å¿†åˆ°Vuejsçš„<a href=\"https://cn.vuejs.org/v2/api/#provide-inject\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">æ–‡æ¡£</a>ä¸Šè¯´æ˜è¿‡ï¼Œ<code class=\"language-text\">provide/inject</code>çš„ç»‘å®šä¸æ˜¯å“åº”å¼çš„ã€‚æƒ³ç»™åŒäº‹è¯´æ˜æ­£ç¡®ç”¨æ³•ï¼Œä½†åŒäº‹å› ä¸ºæ¯”è¾ƒå¿™ç»§ç»­ç”¨<code class=\"language-text\">props</code>äº†ã€‚</p>\n<p>æƒ³åˆ°è‡ªå·±è¢«é—®åˆ°Vuejsä¸­Apiçš„ç”¨æ³•æ—¶ç­”å¾—ä¸å‡†ç¡®ï¼Œè¯¥å¥½å¥½çœ‹çœ‹æºç å’Œæ–‡æ¡£äº†ã€‚</p>\n<h2 id=\"provideinjectçš„ç”¨æ³•\" style=\"position:relative;\"><a href=\"#provideinject%E7%9A%84%E7%94%A8%E6%B3%95\" aria-label=\"provideinjectçš„ç”¨æ³• permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Provide/Injectçš„ç”¨æ³•</h2>\n<p>provideå’Œinjectæ˜¯Vuejsä¸ºäº†ç¥–å…ˆå’Œå­å­™ç»„ä»¶é—´æä¾›çš„ä¾¿æ·çš„ä¼ é€’æ•°å€¼æ–¹æ³•çš„Apiã€‚é€‚åˆé«˜é˜¶æ’ä»¶/ç»„ä»¶åº“å¼€å‘æ—¶ä½¿ç”¨ã€‚</p>\n<p><strong><em>provideå’Œinjectçš„ç»‘å®šä¸æ˜¯å“åº”å¼çš„ã€‚</em></strong></p>\n<h3 id=\"ç±»å‹\" style=\"position:relative;\"><a href=\"#%E7%B1%BB%E5%9E%8B\" aria-label=\"ç±»å‹ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ç±»å‹</h3>\n<p>provideï¼š<code class=\"language-text\">Object | () =&gt; Object</code></p>\n<p>injectï¼š<code class=\"language-text\">Array&lt;string&gt; | { [key: string]: string | Symbol | Object }</code></p>\n<h3 id=\"provideè¯´æ˜\" style=\"position:relative;\"><a href=\"#provide%E8%AF%B4%E6%98%8E\" aria-label=\"provideè¯´æ˜ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>provideè¯´æ˜</h3>\n<p>å¦‚ç±»å‹å®šä¹‰æ‰€ç¤ºï¼Œ<code class=\"language-text\">provide</code>æ¥å—ä¸€ä¸ªå¯¹è±¡æˆ–è€…ä¸€ä¸ªç”Ÿæˆå¯¹è±¡çš„å‡½æ•°ï¼Œç»™æ‰€æœ‰å­å­™ç»„ä»¶æ³¨å…¥æ¥æ”¶åˆ°çš„å€¼ã€‚å¯¹è±¡çš„é”®å¯ä»¥ä¸ºES6çš„<code class=\"language-text\">Symbol</code>ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// æ¥å—ä¸€ä¸ªå¯¹è±¡</span>\n  provide<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    prop1<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// æˆ–è€…æ¥å—ä¸€ä¸ªç”Ÿæˆå¯¹è±¡çš„å‡½æ•°</span>\n  <span class=\"token function\">provide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      prop1<span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"injectè¯´æ˜\" style=\"position:relative;\"><a href=\"#inject%E8%AF%B4%E6%98%8E\" aria-label=\"injectè¯´æ˜ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>injectè¯´æ˜</h3>\n<p>å¦‚ç±»å‹å®šä¹‰æ‰€ç¤ºï¼Œ<code class=\"language-text\">inject</code>æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„æˆ–è€…ä¸€ä¸ªé”®å€¼å¯¹è±¡ï¼Œå¯ä»¥è·å–åˆ°ç¥–å…ˆæ³¨å…¥çš„å±æ€§ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// æ¥å—å­—ç¬¦ä¸²æ•°ç»„</span>\n  inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'prop1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// => this.prop1</span>\n  <span class=\"token comment\">// æ¥å—é”®å€¼å¯¹è±¡</span>\n  inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    newProp1<span class=\"token operator\">:</span> <span class=\"token string\">'prop1'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// => this.newProp1</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>å¦å¤–ï¼Œ<code class=\"language-text\">inject</code>ä¼ å…¥é”®å€¼å¯¹è±¡æ—¶ï¼Œå€¼æ”¯æŒå¸¦æœ‰<code class=\"language-text\">from</code>å’Œ<code class=\"language-text\">default</code>çš„å¯¹è±¡ï¼Œç”¨äºè®¾ç½®injectå€¼çš„æ¥æºåç§°å’Œé»˜è®¤å€¼ã€‚</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ä¸€ä¸ªä¸å­˜åœ¨çš„provideå±æ€§</span>\n    prop3<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">from</span><span class=\"token operator\">:</span> <span class=\"token string\">'prop2'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">default</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// this.prop3å³ä¸º[6, 6, 6]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"provideinjectçš„æºç å®ç°\" style=\"position:relative;\"><a href=\"#provideinject%E7%9A%84%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0\" aria-label=\"provideinjectçš„æºç å®ç° permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Provide/Injectçš„æºç å®ç°</h2>\n<p>çœ‹å®Œäº†Apiæ–‡æ¡£ï¼Œè¯¥çœ‹çœ‹å…·ä½“çš„æºç å®ç°äº†ã€‚</p>\n<p>é¦–å…ˆæ˜¯ç»„ä»¶åˆå§‹åŒ–çš„åœ°æ–¹<code class=\"language-text\">src/core/instance/init.js</code>çš„<code class=\"language-text\">initMixin</code>æ–¹æ³•ä¸­ï¼Œåœ¨ç»„ä»¶çš„<code class=\"language-text\">data/props</code>åŠ è½½å‰åå…ˆåæ‰§è¡Œã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token comment\">// expose real self</span>\n vm<span class=\"token punctuation\">.</span>_self <span class=\"token operator\">=</span> vm\n <span class=\"token function\">initLifecycle</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">)</span>\n <span class=\"token function\">initEvents</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">)</span>\n <span class=\"token function\">initRender</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">)</span>\n <span class=\"token function\">callHook</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">,</span> <span class=\"token string\">'beforeCreate'</span><span class=\"token punctuation\">)</span>\n <span class=\"token function\">initInjections</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">)</span> <span class=\"token comment\">// resolve injections before data/props</span>\n <span class=\"token function\">initState</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">)</span>\n <span class=\"token function\">initProvide</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">)</span> <span class=\"token comment\">// resolve provide after data/props</span>\n <span class=\"token function\">callHook</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">,</span> <span class=\"token string\">'created'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"initprovide\" style=\"position:relative;\"><a href=\"#initprovide\" aria-label=\"initprovide permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>initProvide</h3>\n<p>provideåˆå§‹åŒ–çš„ä»£ç åœ¨<code class=\"language-text\">src/core/instance/inject.js</code>ä¸­ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">initProvide</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">vm<span class=\"token operator\">:</span> Component</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> provide <span class=\"token operator\">=</span> vm<span class=\"token punctuation\">.</span>$options<span class=\"token punctuation\">.</span>provide\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>provide<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    vm<span class=\"token punctuation\">.</span>_provided <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> provide <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span>\n      <span class=\"token operator\">?</span> <span class=\"token function\">provide</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">)</span>\n      <span class=\"token operator\">:</span> provide\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>é€»è¾‘å¾ˆç®€å•ï¼Œè¯»å–å®šä¹‰çš„<code class=\"language-text\">provide</code>å¹¶èµ‹å€¼åœ¨ç»„ä»¶çš„<code class=\"language-text\">_provided</code>å±æ€§ä¸Šã€‚</p>\n<h3 id=\"initinjections\" style=\"position:relative;\"><a href=\"#initinjections\" aria-label=\"initinjections permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>initInjections</h3>\n<p>injectåˆå§‹åŒ–çš„ä»£ç åœ¨<code class=\"language-text\">src/core/instance/inject.js</code>ä¸­ï¼Œä¸‹é¢åˆ†2æ­¥è§£æä¸€ä¸‹ã€‚</p>\n<h4 id=\"injectåˆå§‹åŒ–çš„æ•´ä½“æµç¨‹\" style=\"position:relative;\"><a href=\"#inject%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B\" aria-label=\"injectåˆå§‹åŒ–çš„æ•´ä½“æµç¨‹ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>injectåˆå§‹åŒ–çš„æ•´ä½“æµç¨‹</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">initInjections</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">vm<span class=\"token operator\">:</span> Component</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">resolveInject</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">.</span>$options<span class=\"token punctuation\">.</span>inject<span class=\"token punctuation\">,</span> vm<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">toggleObserving</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// çœç•¥éƒ¨åˆ†ä»£ç </span>\n      <span class=\"token function\">defineReactive</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// çœç•¥éƒ¨åˆ†ä»£ç </span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">toggleObserving</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>æ•´ä½“ä¸Šè¯´ï¼Œinjectçš„å®ç°åˆ†ä¸º2æ­¥:</p>\n<ol>\n<li>è°ƒç”¨<code class=\"language-text\">resolveInject</code>æ–¹æ³•è§£æå‡ºæ‰€æœ‰æœ‰æ•ˆçš„<code class=\"language-text\">inject</code>é”®å€¼å¯¹å­˜æ”¾åœ¨<code class=\"language-text\">result</code>ä¸­ã€‚</li>\n<li>éå†<code class=\"language-text\">result</code>å°†æ‰€æœ‰é”®å€¼å¯¹å®šä¹‰åˆ°ç»„ä»¶çš„ä¸Šä¸‹æ–‡<code class=\"language-text\">vm</code>ä¸­ã€‚</li>\n</ol>\n<h4 id=\"injectå®šä¹‰çš„è§£æ\" style=\"position:relative;\"><a href=\"#inject%E5%AE%9A%E4%B9%89%E7%9A%84%E8%A7%A3%E6%9E%90\" aria-label=\"injectå®šä¹‰çš„è§£æ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>injectå®šä¹‰çš„è§£æ</h4>\n<p>injectçš„è§£æåœ¨æ–¹æ³•<code class=\"language-text\">resolveInject</code>ä¸­(ä¹Ÿåœ¨å½“å‰æ–‡ä»¶<code class=\"language-text\">src/core/instance/inject.js</code>)ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// çœç•¥äº†éƒ¨åˆ†ä¸é‡è¦çš„ä»£ç </span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">resolveInject</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">inject<span class=\"token operator\">:</span> any<span class=\"token punctuation\">,</span> vm<span class=\"token operator\">:</span> Component</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token operator\">?</span>Object <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// åˆ›å»ºä¸´æ—¶å˜é‡</span>\n  <span class=\"token keyword\">const</span> keys <span class=\"token operator\">=</span> hasSymbol             <span class=\"token comment\">// è·å–æ‰€æœ‰åœ¨injectä¸­å®šä¹‰çš„é”®</span>\n      <span class=\"token operator\">?</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">ownKeys</span><span class=\"token punctuation\">(</span>inject<span class=\"token punctuation\">)</span>\n      <span class=\"token operator\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>inject<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> keys<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// å¾ªç¯å¤„ç†æ¯ä¸€ä¸ªé”®</span>\n    <span class=\"token keyword\">const</span> provideKey <span class=\"token operator\">=</span> inject<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>from\n    <span class=\"token keyword\">let</span> source <span class=\"token operator\">=</span> vm\n    <span class=\"token comment\">// ä»å½“å‰ç»„ä»¶ä¸æ–­æŸ¥æ‰¾çˆ¶çº§ç»„ä»¶æ»¡è¶³æ¡ä»¶çš„provideå®šä¹‰</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">.</span>_provided <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">hasOwn</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">.</span>_provided<span class=\"token punctuation\">,</span> provideKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        result<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span>_provided<span class=\"token punctuation\">[</span>provideKey<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">break</span>\n      <span class=\"token punctuation\">}</span>\n      source <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span>$parent\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// provideå®šä¹‰æ²¡æœ‰æ‰¾åˆ°æ—¶</span>\n    <span class=\"token comment\">// å¦‚æœinjectå®šä¹‰äº†defaultå°±ç›´æ¥å–å€¼(æˆ–æ‰§è¡Œ)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>source<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'default'</span> <span class=\"token keyword\">in</span> inject<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> provideDefault <span class=\"token operator\">=</span> inject<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>default\n        result<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> provideDefault <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span>\n          <span class=\"token operator\">?</span> <span class=\"token function\">provideDefault</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">)</span>\n          <span class=\"token operator\">:</span> provideDefault\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Injection \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>key<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" not found</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> vm<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> result\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"injectçš„é”®å€¼æ³¨å…¥\" style=\"position:relative;\"><a href=\"#inject%E7%9A%84%E9%94%AE%E5%80%BC%E6%B3%A8%E5%85%A5\" aria-label=\"injectçš„é”®å€¼æ³¨å…¥ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>injectçš„é”®å€¼æ³¨å…¥</h4>\n<p>æš‚æ—¶å…³é—­Vueå†…éƒ¨çš„å“åº”å¼flagï¼Œå®šä¹‰å±æ€§ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">toggleObserving</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// çœç•¥éƒ¨åˆ†ä»£ç </span>\n  <span class=\"token function\">defineReactive</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// çœç•¥éƒ¨åˆ†ä»£ç </span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">toggleObserving</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ol>\n<li><code class=\"language-text\">toggleObserving</code>ä¸º<code class=\"language-text\">src/core/observer/index.js</code>ä¸­Vueæ ¸å¿ƒçš„æ˜¯å¦å¼€å¯å“åº”å¼çš„flagã€‚</li>\n<li><code class=\"language-text\">defineReactive</code>å³ä¸ºVuejsçš„æ ¸å¿ƒå®ç°æ–¹å¼ï¼Œä¸ä»‹ç»äº†ã€‚</li>\n</ol>\n<p>ç»è¿‡äº†ä¸Šé¢çš„æ­¥éª¤injectå®Œæˆäº†æ³¨å…¥ã€‚</p>\n<h2 id=\"provideinjectå¦‚ä½•å®ç°ç»‘å®šå“åº”å¼\" style=\"position:relative;\"><a href=\"#provideinject%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BB%91%E5%AE%9A%E5%93%8D%E5%BA%94%E5%BC%8F\" aria-label=\"provideinjectå¦‚ä½•å®ç°ç»‘å®šå“åº”å¼ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Provide/Injectå¦‚ä½•å®ç°ç»‘å®šå“åº”å¼</h2>\n<p><code class=\"language-text\">provide/inject</code>ç›´æ¥æ³¨å…¥æ²¡æœ‰å“åº”å¼ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡<code class=\"language-text\">å¯¹è±¡å±æ€§</code>å®ç°ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    wrapper<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      a<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      b<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">provide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      wrapper<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>wrapper<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'wrapper'</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// æ­¤æ—¶wrapper.aã€wrapper.bæ˜¯å“åº”å¼çš„</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>è¿™ä¹Ÿå°±æ˜¯Apiæ–‡æ¡£ä¸­è¯´çš„<code class=\"language-text\">å¦‚æœä½ ä¼ å…¥äº†ä¸€ä¸ªå¯ç›‘å¬çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå…¶å¯¹è±¡çš„å±æ€§è¿˜æ˜¯å¯å“åº”çš„</code>ã€‚</p>\n</blockquote>\n<p>çœ‹åˆ°è¿™é‡Œï¼ŒğŸ˜å¯ä»¥æ‰¾åŒäº‹å¹ç‰›äº†ã€‚</p>\n<h2 id=\"æ„Ÿæƒ³\" style=\"position:relative;\"><a href=\"#%E6%84%9F%E6%83%B3\" aria-label=\"æ„Ÿæƒ³ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>æ„Ÿæƒ³</h2>\n<ol>\n<li>Vuejsçš„æ–‡æ¡£ä¸­è®°å½•äº†å¾ˆå¤šå¾ˆç»†çš„çŸ¥è¯†ç‚¹ï¼Œå¯¹äºéœ€è¦ä½¿ç”¨å®ƒåšå¼€å‘çš„äººå‘˜æ¥è¯´ï¼Œå¿…é¡»å…¨é¢é˜…è¯»æ¢³ç†ä¸€éã€‚å¦‚æœæœ‰æ—¶é—´ä¹Ÿåº”è¯¥ç¿»ç¿»æºç çš„å®ç°ï¼Œå­¦ä¹ ä¸€äº›å¼€å‘æŠ€å·§ã€äº†è§£ç›¸å…³çš„çŸ¥è¯†ã€‚åŸæ¥æºç å¹¶æ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆæ·±å¥¥ã€‚</li>\n<li>Vuejsçš„Apiè¶Šæ¥è¶Šå¤š(æœ€å¼€å§‹æ¥è§¦æ—¶<code class=\"language-text\">inject</code>è¿˜æ²¡æœ‰<code class=\"language-text\">default</code>å±æ€§)ï¼Œè™½ç„¶ä¸Šæ‰‹ä¾æ—§å¾ˆå¿«ï¼Œä½†å¯¹äºåˆå­¦è€…æ¥è¯´Vuejså­¦ä¹ æˆæœ¬ä¹Ÿåœ¨é€æ­¥å‡é«˜ã€‚</li>\n</ol>","fields":{"slug":"/posts/vue-provide-inject","tagSlugs":["/tag/å‰ç«¯/","/tag/vuejs/"]},"frontmatter":{"date":"2020-02-23 23:00","description":"æœ€è¿‘åœ¨å·¥ä½œä¸­ï¼Œè¢«ä¸€ä¸ªåŒäº‹é—®åˆ°äº†provide/injectçš„ç”¨æ³•ã€‚è¿™ä¸ç®€å•å˜›ï¼Œå½“å³ç»™å‡ºç­”æ¡ˆ...","tags":["å‰ç«¯","Vuejs"],"title":"Vuejsä¸­çš„provide/inject","socialImage":"vue.jpg"}}},"pageContext":{"slug":"/posts/vue-provide-inject"}}}