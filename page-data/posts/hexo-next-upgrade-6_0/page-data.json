{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/hexo-next-upgrade-6_0","result":{"data":{"markdownRemark":{"id":"10f9cb4c-1a70-50ee-a78a-ca43f4d576b8","html":"<p>很久没写Po了。</p>\n<p>最近决定写一波查查next下的一些配置，发现next有6.0了。</p>\n<p>研究了一下<a href=\"https://github.com/theme-next/hexo-theme-next/blob/master/docs/zh-CN/UPDATE-FROM-5.1.X.md\" title=\"升级日志\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">升级日志</a>，改动不多，简单操作即可。</p>\n<h2 id=\"升级步骤\" style=\"position:relative;\"><a href=\"#%E5%8D%87%E7%BA%A7%E6%AD%A5%E9%AA%A4\" aria-label=\"升级步骤 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>升级步骤</h2>\n<ol>\n<li>\n<p>clone next主题的新代码</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  $ <span class=\"token function\">git</span> clone https://github.com/theme-next/hexo-theme-next themes/next-reloaded</code></pre></div>\n<p>这边需要注意的是，官方推荐将主题代码下载到<code class=\"language-text\">themes</code>下的新目录中(比如这边的<code class=\"language-text\">next-reloaded</code>)，这种方式便于当新主题出错时可以随时切换到老主题。</p>\n</li>\n<li>\n<p>拷贝next主题中修改的文件至新主题目录中</p>\n<p>之前next目录是直接<code class=\"language-text\">git clone</code>下来的，所以<code class=\"language-text\">git status</code>查看一下就好了。</p>\n<p>博主因为只修改了头像和网站icon等图像文件，所以简单拷贝粘贴即可。</p>\n</li>\n<li>\n<p>next的配置文件<code class=\"language-text\">themes/next/_config.yml</code></p>\n<p>文件<code class=\"language-text\">themes/next/_config.yml</code>中配置了很多的next下的实用功能，例如: rss、 首页菜单、 next内部主题、评论系统、Google Analysis等。这些都需要迁移到新next配置文件中。</p>\n<p>一个比较好的方法就是先<code class=\"language-text\">git diff themes/next/_config.yml</code>得到自己的配置内容，然后通过diff工具比较<code class=\"language-text\">next/_config.yml</code>与<code class=\"language-text\">next-reload/_config.yml</code>，将diff的内容合并到文件中。</p>\n</li>\n<li>\n<p>hexo的\b配置文件切换主题</p>\n<p>hexo静态博客的配置文件<code class=\"language-text\">./_config.yml</code>中切换主题为新主题目录<code class=\"language-text\">next-reloaded</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">theme</span><span class=\"token punctuation\">:</span> next<span class=\"token punctuation\">-</span>reloaded\n<span class=\"token punctuation\">...</span></code></pre></div>\n</li>\n</ol>\n<h2 id=\"升级完成\" style=\"position:relative;\"><a href=\"#%E5%8D%87%E7%BA%A7%E5%AE%8C%E6%88%90\" aria-label=\"升级完成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>升级完成</h2>\n<p>通过上面四步，\b\b基本上升级完成。</p>\n<p>本地运行<code class=\"language-text\">hexo s</code>查看效果。</p>\n<p>如果没问题直接<code class=\"language-text\">hexo g -d</code>提交发布。</p>\n<h2 id=\"升级发现的问题\" style=\"position:relative;\"><a href=\"#%E5%8D%87%E7%BA%A7%E5%8F%91%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98\" aria-label=\"升级发现的问题 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>升级发现的问题</h2>\n<h3 id=\"主页左上部分的链接从中文变成了英文\" style=\"position:relative;\"><a href=\"#%E4%B8%BB%E9%A1%B5%E5%B7%A6%E4%B8%8A%E9%83%A8%E5%88%86%E7%9A%84%E9%93%BE%E6%8E%A5%E4%BB%8E%E4%B8%AD%E6%96%87%E5%8F%98%E6%88%90%E4%BA%86%E8%8B%B1%E6%96%87\" aria-label=\"主页左上部分的链接从中文变成了英文 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>主页左上部分的链接从中文变成了英文</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 558px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/43141b75253ca049b1f232005b87a529/bb41d/hexo6_0-problem1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe5vGyKJQgP/xAAWEAADAAAAAAAAAAAAAAAAAAAQESD/2gAIAQEAAQUCpH//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/Ah//xAAcEAABAwUAAAAAAAAAAAAAAAABABAhMUFxofD/2gAIAQEAAT8hOduelCiKlcv/AP/aAAwDAQACAAMAAAAQowA8/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRAAAwACAgMAAAAAAAAAAAAAAAERITFBYVFxgf/aAAgBAQABPxBspYYXJck7Gox49xTzRqzftNhw0enCdsayf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/43141b75253ca049b1f232005b87a529/8ac56/hexo6_0-problem1.webp 240w,\n/static/43141b75253ca049b1f232005b87a529/d3be9/hexo6_0-problem1.webp 480w,\n/static/43141b75253ca049b1f232005b87a529/1c397/hexo6_0-problem1.webp 558w\"\n          sizes=\"(max-width: 558px) 100vw, 558px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/43141b75253ca049b1f232005b87a529/09b79/hexo6_0-problem1.jpg 240w,\n/static/43141b75253ca049b1f232005b87a529/7cc5e/hexo6_0-problem1.jpg 480w,\n/static/43141b75253ca049b1f232005b87a529/bb41d/hexo6_0-problem1.jpg 558w\"\n          sizes=\"(max-width: 558px) 100vw, 558px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/43141b75253ca049b1f232005b87a529/bb41d/hexo6_0-problem1.jpg\"\n          alt=\"hexo6-0升级问题1\"\n          title=\"hexo6-0升级问题1\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p><a href=\"https://github.com/theme-next/hexo-theme-next/issues/157\" title=\"set &#x60;language: zh-Hans&#x60; invalid [renamed &#x60;zh-Hans&#x60; to &#x60;zh-CN&#x60;]\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github上相关issue</a></p>\n<p>Github上也有人提出了这个问题，hexo-next在v6.0.3版本调整了配置，<code class=\"language-text\">zh-Hans</code>改为了<code class=\"language-text\">zh-CN</code>。</p>\n<p>修改hexo配置<code class=\"language-text\">_config.yml</code>即可。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 508px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9e76a19e1839c88e2ff4d1e68652c441/a2d2e/hexo6_0-problem1_solved.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 118.50393700787403%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAYABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3aiwCaAD/8QAFhAAAwAAAAAAAAAAAAAAAAAAECBB/9oACAEBAAEFAjV//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFhAAAwAAAAAAAAAAAAAAAAAAECDh/9oACAEBAAY/AjG//8QAGhAAAgIDAAAAAAAAAAAAAAAAARARIUFx8f/aAAgBAQABPyG5y9GInr//2gAMAwEAAgADAAAAELDHAP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EABwQAAICAwEBAAAAAAAAAAAAAAERAFEhMUEQYf/aAAgBAQABPxBJyj+LURuI3EOTYy1X4Y0K7mOQIDcJn//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/9e76a19e1839c88e2ff4d1e68652c441/8ac56/hexo6_0-problem1_solved.webp 240w,\n/static/9e76a19e1839c88e2ff4d1e68652c441/d3be9/hexo6_0-problem1_solved.webp 480w,\n/static/9e76a19e1839c88e2ff4d1e68652c441/7b066/hexo6_0-problem1_solved.webp 508w\"\n          sizes=\"(max-width: 508px) 100vw, 508px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/9e76a19e1839c88e2ff4d1e68652c441/09b79/hexo6_0-problem1_solved.jpg 240w,\n/static/9e76a19e1839c88e2ff4d1e68652c441/7cc5e/hexo6_0-problem1_solved.jpg 480w,\n/static/9e76a19e1839c88e2ff4d1e68652c441/a2d2e/hexo6_0-problem1_solved.jpg 508w\"\n          sizes=\"(max-width: 508px) 100vw, 508px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/9e76a19e1839c88e2ff4d1e68652c441/a2d2e/hexo6_0-problem1_solved.jpg\"\n          alt=\"hexo6-0升级问题1解决\"\n          title=\"hexo6-0升级问题1解决\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<h3 id=\"页面leancloud访问统计提示counter-not-initialized-see-more-at-console-err-msg\" style=\"position:relative;\"><a href=\"#%E9%A1%B5%E9%9D%A2leancloud%E8%AE%BF%E9%97%AE%E7%BB%9F%E8%AE%A1%E6%8F%90%E7%A4%BAcounter-not-initialized-see-more-at-console-err-msg\" aria-label=\"页面leancloud访问统计提示counter not initialized see more at console err msg permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>页面LeanCloud访问统计提示’Counter not initialized! See more at console err msg.’</h3>\n<p>2018年初发现next使用的LeanCloud访客统计插件存在重大安全漏洞，需要手动修复。</p>\n<p>参考文章: <a href=\"https://leaferx.online/2018/02/11/lc-security/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NexT主题使用的Leancloud访客统计插件存在重大安全漏洞</a></p>\n<p>Ps: 如果在配置<code class=\"language-text\">- type: leancloud_counter_security_sync</code>后hexo运行出现文件解析错误，了解一下<a href=\"http://yaml.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">YAML基础语法</a>就行了。</p>\n<h3 id=\"站点无限转圈无弹窗\" style=\"position:relative;\"><a href=\"#%E7%AB%99%E7%82%B9%E6%97%A0%E9%99%90%E8%BD%AC%E5%9C%88%E6%97%A0%E5%BC%B9%E7%AA%97\" aria-label=\"站点无限转圈无弹窗 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>站点🔍无限转圈无弹窗</h3>\n<p>博主的站点启用了local_search功能，next v5的时候🔍功能确定可用，但是升级后就不行了。</p>\n<p>经过调查和翻阅Github找到了解决方式，删除<code class=\"language-text\">hexo-generator-searchdb</code>模块然后<code class=\"language-text\">hexo clean</code>并重新运行即可。</p>\n<blockquote>\n<p><code class=\"language-text\">hexo-generator-searchdb</code> was forked from <code class=\"language-text\">hexo-generator-search</code>\nThis is a bug in early version of the <code class=\"language-text\">hexo-generator-search</code> and it has been fixed recently</p>\n<p><code class=\"language-text\">hexo-generator-searchdb</code>是<code class=\"language-text\">hexo-generator-search</code>的一份fork。\n早期版本的<code class=\"language-text\">hexo-generator-search</code>存在bug，近期被修复了导致。</p>\n</blockquote>\n<hr>\n<p>以上是简单的升级记录，后续有问题会继续更新</p>","fields":{"slug":"/posts/hexo-next-upgrade-6_0","tagSlugs":["/tag/hexo/","/tag/hexo-theme-next/","/tag/hexo-leancloud-counter-security/","/tag/leancloud/","/tag/hexo-generator-searchdb/"]},"frontmatter":{"date":"2018-04-26 14:25:08","description":"","tags":["hexo","hexo-theme-next","hexo-leancloud-counter-security","leancloud","hexo-generator-searchdb"],"title":"next主题升级6.0","socialImage":""}}},"pageContext":{"slug":"/posts/hexo-next-upgrade-6_0"}}}