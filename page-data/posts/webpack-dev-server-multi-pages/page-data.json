{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/webpack-dev-server-multi-pages","result":{"data":{"markdownRemark":{"id":"90351097-2d24-54bd-98d2-d321729507d3","html":"<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>一直以来公司的前端项目都是一个项目一个vue-cli生成的SPA，然后放入不同的业务画面的iframe中。</p>\n<p>起初，只有一两个项目时，代码管理和开发还是比较轻松的。但当老系统逐渐拆分，新项目的不断启动，问题就来了。</p>\n<h2 id=\"问题\" style=\"position:relative;\"><a href=\"#%E9%97%AE%E9%A2%98\" aria-label=\"问题 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>问题</h2>\n<h3 id=\"项目的创建\" style=\"position:relative;\"><a href=\"#%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%88%9B%E5%BB%BA\" aria-label=\"项目的创建 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>项目的创建</h3>\n<p>项目越来越多，每一个都需要单独vue-cli生成，然后配置一堆参数。当一个配置的参数有变，所有的其他项目都需要联动调整，维护量较大。</p>\n<h3 id=\"项目的编码维护\" style=\"position:relative;\"><a href=\"#%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%BC%96%E7%A0%81%E7%BB%B4%E6%8A%A4\" aria-label=\"项目的编码维护 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>项目的编码维护</h3>\n<p>每个项目，所属的业务不同。但是整体上应当： 系统UI一致、部分相同业务逻辑代码处理一致。重复coding很多，维护量也很大。当编码不受控时，各个项目的处理方式也可能各不相同。</p>\n<h3 id=\"iframe性能问题\" style=\"position:relative;\"><a href=\"#iframe%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98\" aria-label=\"iframe性能问题 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>iframe性能问题</h3>\n<p>iframe在使用中，问题不少。</p>\n<ul>\n<li>iframe相当于一个完整的页面，内存cpu占用是一个问题；</li>\n<li>iframe和主页面共享同一个连接池，可能会和主页面相互影响；</li>\n<li>iframe不同平台(PC和移动等)、不同浏览器(Chrome和IE等)效果有差异，适配也是难点；</li>\n<li>iframe和主页面需要考虑跨域的问题；</li>\n<li>等等等…</li>\n</ul>\n<p>所以很多地方建议前端尽可能少用iframe。</p>\n<h2 id=\"解决方法\" style=\"position:relative;\"><a href=\"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95\" aria-label=\"解决方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>解决方法</h2>\n<p>对于各种发现的问题，简单构想一下可以整合前台项目，通过Webpack按项目打包生成多个SPA。</p>\n<h3 id=\"项目配置\" style=\"position:relative;\"><a href=\"#%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE\" aria-label=\"项目配置 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>项目配置</h3>\n<p>之前在一篇文章<a href=\"/posts/webpack2-multi-pages\">Webpack2中多页应用的实现</a>中写到了项目最终打包生成多页的配置文件，但是开发模式上一直没能解决完整启动多页的功能。</p>\n<p>这次研究了一下webpackDevServer，终于找到了可行的解决方法。</p>\n<h3 id=\"项目配置思路\" style=\"position:relative;\"><a href=\"#%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF\" aria-label=\"项目配置思路 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>项目配置思路</h3>\n<p>在Webpack中，入口js是配置项的entry，最终的html生成是plugin中<code class=\"language-text\">HtmlWebpackPlugin</code>插件实现。</p>\n<p>实际使用中，就是找到各个页面入口js和入口html，加入配置就行。</p>\n<h3 id=\"配置demo\" style=\"position:relative;\"><a href=\"#%E9%85%8D%E7%BD%AEdemo\" aria-label=\"配置demo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>配置Demo</h3>\n<p>下面是一个比较简单的多页HTML Demo配置</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> entry <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  page1<span class=\"token operator\">:</span> <span class=\"token string\">'./src/page1.js'</span><span class=\"token punctuation\">,</span>\n  page2<span class=\"token operator\">:</span> <span class=\"token string\">'./src/page2.js'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> htmlPlugins <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    template<span class=\"token operator\">:</span> <span class=\"token string\">'./src/page1.html'</span><span class=\"token punctuation\">,</span>\n    filename<span class=\"token operator\">:</span> <span class=\"token string\">'page1.html'</span><span class=\"token punctuation\">,</span>\n    inject<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    chunks<span class=\"token operator\">:</span> <span class=\"token string\">'all'</span><span class=\"token punctuation\">,</span>\n    excludeChunks<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'page2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    chunksSortMode<span class=\"token operator\">:</span> <span class=\"token string\">'dependency'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    template<span class=\"token operator\">:</span> <span class=\"token string\">'./src/page2.html'</span><span class=\"token punctuation\">,</span>\n    filename<span class=\"token operator\">:</span> <span class=\"token string\">'page2.html'</span><span class=\"token punctuation\">,</span>\n    inject<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    chunks<span class=\"token operator\">:</span> <span class=\"token string\">'all'</span><span class=\"token punctuation\">,</span>\n    excludeChunks<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'page1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    chunksSortMode<span class=\"token operator\">:</span> <span class=\"token string\">'dependency'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ok，按照这个配置，生产编译问题解决了。</p>\n<p>但是开发环境呢。。。</p>\n<h3 id=\"开发环境配置\" style=\"position:relative;\"><a href=\"#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE\" aria-label=\"开发环境配置 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>开发环境配置</h3>\n<p>之前公司项目中也用到了多页配置，加上了HtmlWebpackPlugin实现了，但是每次只能启动一个单页。虽然两个模板关系不是特别紧密，但是如果能一次直接启动全部肯定是更好的。</p>\n<p>正好最近在给自己的项目模板做 <code class=\"language-text\">Webpack 4</code> 升级的过程中也遇到了这个问题，所以自己翻查了下webpackDevServer的文档说明，找到了解决方案<a href=\"https://webpack.js.org/configuration/dev-server/#devserver-historyapifallback\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">devServer.historyApiFallback</a>。</p>\n<p>参照文档描述，只需要自己指定路由重写机制，就可以实现开发模式多页面注入并导航。</p>\n<p>那上面的demo，配置类似如下写法就可以满足需求。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">historyApiFallback<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  rewrites<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span><span class=\"token operator\">:</span> <span class=\"token regex\">/^\\/$/</span><span class=\"token punctuation\">,</span> to<span class=\"token operator\">:</span> <span class=\"token string\">'/page1.html'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span><span class=\"token operator\">:</span> <span class=\"token regex\">/^\\/page1/</span><span class=\"token punctuation\">,</span> to<span class=\"token operator\">:</span> <span class=\"token string\">'/page1.html'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token keyword\">from</span><span class=\"token operator\">:</span> <span class=\"token regex\">/^\\/page2/</span><span class=\"token punctuation\">,</span> to<span class=\"token operator\">:</span> <span class=\"token string\">'/page2.html'</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"一个现成的项目例子\" style=\"position:relative;\"><a href=\"#%E4%B8%80%E4%B8%AA%E7%8E%B0%E6%88%90%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%BE%8B%E5%AD%90\" aria-label=\"一个现成的项目例子 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>一个现成的项目例子</h2>\n<p>多页的开发生产配置项目，已经上传了<a href=\"https://github.com/suyi91/simple-frontend-template\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">suyi91/simple-frontend-template</a> 源代码为<a href=\"https://github.com/suyi91/simple-frontend-template/archive/1.2.0.zip\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">1.2.0版本</a></p>","fields":{"slug":"/posts/webpack-dev-server-multi-pages","tagSlugs":["/tag/webpack/","/tag/vue/","/tag/前端/","/tag/html-webpack-plugin/","/tag/webpack-dev-server/"]},"frontmatter":{"date":"2018-05-16 22:42:54","description":"一直以来公司的前端项目都是一个项目一个vue-cli生成的SPA，然后放入不同的业务画面的iframe中...","tags":["webpack","vue","前端","html-webpack-plugin","webpack-dev-server"],"title":"WebpackDevServer实现多页应用","socialImage":""}}},"pageContext":{"slug":"/posts/webpack-dev-server-multi-pages"}}}