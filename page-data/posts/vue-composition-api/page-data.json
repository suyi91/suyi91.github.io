{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/vue-composition-api","result":{"data":{"markdownRemark":{"id":"b31ad71f-99fc-5d0b-99f3-d534e773fb62","html":"<p>2019å¹´ä¸‹åŠå¹´ï¼ŒVuejså®˜æ–¹æ¨å‡ºäº†<a href=\"https://composition-api.vuejs.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">CompositionApi RFC</code></a>ï¼Œæ•²å®šäº†Vue3çš„å‡½æ•°å¼Apiè®¾è®¡ã€‚ä¸ºäº†è®©å¹¿å¤§Vuejsä½¿ç”¨è€…å¯ä»¥æå‰å°é²œï¼Œå®˜æ–¹æ¨å‡ºäº†Vue2çš„å…¼å®¹åº“<a href=\"https://www.npmjs.com/package/@vue/composition-api\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">@vue/composition-api</code></a>(åŸå<a href=\"https://www.npmjs.com/package/vue-function-api\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">vue-function-api</code></a>)ã€‚</p>\n<p>ä½œä¸ºä¸€ä¸ªå¯¹æ–°äº‹ç‰©å……æ»¡äº†å¥½å¥‡çš„äººï¼Œ<code class=\"language-text\">CompositionApi</code>åˆšæ¨å‡ºæ—¶å°±å¼€å§‹åœ¨ä¸šåŠ¡ä¸­å°è¯•ä½¿ç”¨ã€‚å¯¹æ¯”ä¹‹å‰çš„Vueç»„ä»¶ä¹¦å†™æ–¹å¼ï¼Œ<code class=\"language-text\">CompositionApi</code>çš„å‡½æ•°å¼ä¸€ç›´ç”¨ä¸€ç›´çˆ½ã€‚</p>\n<h2 id=\"vueç»„ä»¶çš„å†™æ³•\" style=\"position:relative;\"><a href=\"#vue%E7%BB%84%E4%BB%B6%E7%9A%84%E5%86%99%E6%B3%95\" aria-label=\"vueç»„ä»¶çš„å†™æ³• permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vueç»„ä»¶çš„å†™æ³•</h2>\n<h3 id=\"optionså®šä¹‰\" style=\"position:relative;\"><a href=\"#options%E5%AE%9A%E4%B9%89\" aria-label=\"optionså®šä¹‰ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>optionså®šä¹‰</h3>\n<p>Vuejsä¸­å­˜åœ¨æœ€ä¹…çš„å®šä¹‰æ–¹å¼ï¼Œé€šè¿‡å®šä¹‰å¯¹è±¡å±æ€§çš„æ–¹å¼ï¼Œå®ç°Vueç»„ä»¶ã€‚ä¸€ä¸ªç®€å•çš„ğŸŒ°å¦‚ä¸‹ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">'CustomComponent'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">mounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ç»„ä»¶mountedæ—¶æ‰§è¡Œçš„æ–¹æ³•</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  methods<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>optionså®šä¹‰çš„æ–¹å¼ä¹¦å†™ç®€å•ï¼Œæ˜“äºä¸Šæ‰‹(ç»„é‡Œçš„åç«¯åŒå­¦ä¹Ÿå¯ä»¥è¾ƒå¿«åœ°å†™èµ·ä»£ç æ¥)ã€‚</p>\n<p>ä½†optionsæ–¹å¼å†™ä¹…äº†ï¼Œå„ç§é—®é¢˜é€æ¸æš´éœ²:</p>\n<ol>\n<li>è®°å¿†è´Ÿæ‹…å¤§ã€‚Vueç»„ä»¶çš„Apiå¾ˆå¤šï¼Œéƒ½éœ€è¦è®°å¿†ã€‚</li>\n<li>ç±»å‹ç³»ç»Ÿå·®ï¼ŒTSæ”¯æŒå ªå¿§ã€‚TSä½œä¸ºå‰ç«¯ä¹‹è·¯çš„ä¸€ä¸ªè¶‹åŠ¿å·²ç»å·¥ç¨‹è´¨é‡çš„ä¸€ç§ä¿éšœæ–¹å¼ï¼Œå»ºè®®é¡¹ç›®éƒ½å¯ä»¥æ¥å…¥ï¼Œä½†æ˜¯Vueç»„ä»¶æ”¯æŒå¾ˆå·®(ç”±äº<code class=\"language-text\">this.xxx</code>ä»¥åŠoptionså®šä¹‰çš„å±æ€§å–å¾—ä¸åŒäºjså¯¹è±¡å±æ€§è·å–)ï¼Œéœ€è¦å„ç§hackå’ŒIDEæ’ä»¶ã€‚</li>\n<li>ç›¸å…³ä¸šåŠ¡é€»è¾‘ä»£ç åˆ†éš”è¿‡è¿œã€‚å¦‚æœä¸€æ®µä¸šåŠ¡é€»è¾‘ä»£ç æ—¢å­˜åœ¨äºdataã€åˆå­˜åœ¨äºmethodsï¼Œå¤æ‚ç»„ä»¶å†…éƒ¨åˆ†éš”è¿‡è¿œæ¯”è¾ƒå½±å“å¯è¯»æ€§ã€‚</li>\n<li>ç›¸åŒé€»è¾‘å¤ç”¨å›°éš¾ã€‚optionsæ–¹å¼å®ç°çš„ä»£ç ä¸­ä¼šå­˜åœ¨å¤§é‡çš„<code class=\"language-text\">this.xxx</code>è°ƒç”¨ï¼Œä¸åˆ©äºé€šç”¨é€»è¾‘æå–ã€‚(Vuejså®˜æ–¹ä¸ºäº†è§£å†³å¤ç”¨é—®é¢˜å¼•å…¥äº†<code class=\"language-text\">mixins</code>çš„æ¦‚å¿µï¼Œä½†å¸¦æ¥äº†å…¶ä»–çš„é—®é¢˜ï¼Œå·²è®¡åˆ’å¤§ç‰ˆæœ¬å‡çº§æ—¶åˆ é™¤)ã€‚</li>\n</ol>\n<h3 id=\"classç»„ä»¶\" style=\"position:relative;\"><a href=\"#class%E7%BB%84%E4%BB%B6\" aria-label=\"classç»„ä»¶ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>classç»„ä»¶</h3>\n<p>æœ‰ç‚¹ç±»ä¼¼éš”å£Angularçš„ç»„ä»¶å®šä¹‰æ–¹å¼ï¼ŒVuejså®˜æ–¹æ¨å‡ºè¿‡<a href=\"https://github.com/vuejs/vue-class-component\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">vue-class-component</code></a>åº“(è¿˜æœ‰ä¸€ä¸ªæ‰©å±•åº“<a href=\"https://github.com/kaorun343/vue-property-decorator\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">vue-property-decorator</code></a>)å¸¦æ¥äº†classå’Œè£…é¥°å™¨ä¹¦å†™ç»„ä»¶çš„æ”¯æŒã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">'XxxComponent'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">XxxComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Vue</span> <span class=\"token punctuation\">{</span>\n  @<span class=\"token function\">Prop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> label<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä½¿ç”¨ä¹…äº†å‘ç°classç»„ä»¶ä¹Ÿåªæ˜¯ä¸€ä¸ªåŠæˆå“ï¼ŒVuejsçš„Apiéƒ½è¦é€šè¿‡äºŒæ¬¡å°è£…å¤„ç†çš„æ–¹å¼å®ç°æ”¯æŒï¼Œä»£ç é€»è¾‘å¤ç”¨çš„é—®é¢˜ä¾ç„¶æ²¡æœ‰å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆ(ä»ç„¶æ˜¯mixins)ã€‚</p>\n<p>classç»„ä»¶ä¹Ÿæœ‰å¥½çš„æ–¹é¢ï¼Œå°±æ˜¯TSå¯ä»¥å®Œæ•´æ”¯æŒäº†ã€‚</p>\n<h3 id=\"compositionapiæ–¹å¼\" style=\"position:relative;\"><a href=\"#compositionapi%E6%96%B9%E5%BC%8F\" aria-label=\"compositionapiæ–¹å¼ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CompositionApiæ–¹å¼</h3>\n<p>CompositionApiä½œä¸ºä¸€ä¸ªå…¨æ–°çš„æ¦‚å¿µï¼ŒæŠ›å¼ƒäº†åŸæœ‰çš„optionså®šä¹‰æ–¹å¼æ”¹ä¸ºæä¾›å‡½æ•°å¼çš„APIã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªğŸŒ°ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">defineComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">'XxxComponent'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props<span class=\"token punctuation\">,</span> ctx</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> ref<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token function\">reactive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      a<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      b<span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      value<span class=\"token punctuation\">,</span>\n      obj\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>compositionApiçš„å¼•å…¥ï¼Œæ ‡å¿—æ€§çš„å°±æ˜¯ç»„ä»¶å†…çš„<code class=\"language-text\">setup</code>æ–¹æ³•ã€‚setupè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­æ¯ä¸€ä¸ªé”®å†…å®¹éƒ½ä¼šæš´éœ²ç»™ç»„ä»¶æ•´ä½“ã€‚</p>\n<p>ä½¿ç”¨compositionApiï¼Œå¯ä»¥å¸¦æ¥ä¸‹é¢çš„å¥½å¤„:</p>\n<ol>\n<li>data/methods/computed/watch/provide/injectä»¥åŠç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç­‰ç­‰éƒ½å¯ä»¥ç›´æ¥åŒ…å«setupæ–¹æ³•å†…éƒ¨ï¼Œä½¿ç”¨èµ·æ¥ç›´æˆªäº†å½“ã€‚</li>\n<li>setupå°±æ˜¯ä¸€ä¸ªå‡½æ•°æ•´ä½“ï¼Œåœ¨é‡Œé¢å†™ä»£ç æ‘†è„±äº†åŸVuejsçš„ç»„ä»¶æ¨¡æ¿å®šä¹‰æ–¹å¼ï¼Œè®©ä½¿ç”¨è€…æ›´åŠ è§‰å¾—åœ¨å†™æ™®é€šçš„jsä¸€æ ·ã€‚</li>\n<li>compositionApiå¸¦æ¥çš„ref/reactiveç­‰ç­‰Apiä»¥åŠä¸å†éœ€è¦å†™this.xxxï¼Œç»™äºˆäº†æ–¹ä¾¿æå–ä»£ç å—çš„å¯èƒ½ã€‚</li>\n<li>ä½¿ç”¨compositionApiå†™ä»£ç å°±æ˜¯åœ¨å†™æ™®é€šjsï¼Œæ²¡æœ‰thisã€‚TSçš„æ”¯æŒè¾ƒå¥½ã€‚</li>\n</ol>\n<h2 id=\"compositionapiçš„ä½¿ç”¨ä»‹ç»\" style=\"position:relative;\"><a href=\"#compositionapi%E7%9A%84%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D\" aria-label=\"compositionapiçš„ä½¿ç”¨ä»‹ç» permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CompositionApiçš„ä½¿ç”¨ä»‹ç»</h2>\n<blockquote>\n<p>å®˜æ–¹æ–‡æ¡£ä¸­çš„åŸºç¡€å†…å®¹å°±ä¸èµ˜è¿°äº†ï¼Œä¸‹é¢è®²å‡ ç‚¹ä½¿ç”¨æ—¶çš„æ”¶è·ã€‚</p>\n</blockquote>\n<h3 id=\"è·å–åŠ¨æ€ç”Ÿæˆrefçš„ç»„ä»¶\" style=\"position:relative;\"><a href=\"#%E8%8E%B7%E5%8F%96%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90ref%E7%9A%84%E7%BB%84%E4%BB%B6\" aria-label=\"è·å–åŠ¨æ€ç”Ÿæˆrefçš„ç»„ä»¶ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>è·å–åŠ¨æ€ç”Ÿæˆrefçš„ç»„ä»¶</h3>\n<p>CompositionApiæä¾›äº†<code class=\"language-text\">ref</code>ä½œä¸ºé¡µé¢ç»„ä»¶refçš„è·å–æ–¹å¼ï¼Œä½†ä»…é™äºç¼–ç æ—¶refå·²çŸ¥çš„åœºæ™¯ã€‚</p>\n<p>å¯¹äºè¿è¡Œæ—¶ç”Ÿæˆçš„refç»„ä»¶ï¼Œåªèƒ½ä½¿ç”¨<code class=\"language-text\">ctx.refs[xxx]</code>çš„æ–¹å¼è·å–ã€‚(composition-apiåº“çš„ctxç±»å‹SetupContextä¸­æ²¡æœ‰æè¿°ï¼Œæ–‡æ¡£ä¹Ÿæ²¡æœ‰è¯´æ˜ï¼Œæ¯”è¾ƒå¥‡æ€ª)ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>div<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">:ref</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">'</span>span' + ts<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>span<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token keyword\">const</span> ts <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props<span class=\"token punctuation\">,</span> ctx</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> divRef <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">onMounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>divRef<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span> <span class=\"token comment\">// é¡µé¢æŒ‚è½½åå¯ä»¥å–å¾—</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span>refs<span class=\"token punctuation\">[</span><span class=\"token string\">'span'</span> <span class=\"token operator\">+</span> ts<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ­¤æ—¶ref=\"span + xxx\"çš„spanåªèƒ½ä½¿ç”¨è¿™ç§æ–¹å¼è·å–</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      div<span class=\"token operator\">:</span> divRef<span class=\"token punctuation\">,</span>\n      ts\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3 id=\"å¤æ‚é¡µé¢ç»„ä»¶å†…éƒ¨æ•°æ®ç®¡ç†\" style=\"position:relative;\"><a href=\"#%E5%A4%8D%E6%9D%82%E9%A1%B5%E9%9D%A2%E7%BB%84%E4%BB%B6%E5%86%85%E9%83%A8%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86\" aria-label=\"å¤æ‚é¡µé¢ç»„ä»¶å†…éƒ¨æ•°æ®ç®¡ç† permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>å¤æ‚é¡µé¢/ç»„ä»¶å†…éƒ¨æ•°æ®ç®¡ç†</h3>\n<p>ä¸šåŠ¡å¼€å‘ä¸­çš„ä¸€äº›å¤æ‚é¡µé¢ï¼Œä»ä¾¿äºç»´æŠ¤çš„è§’åº¦ä¼šæ‹†åˆ†å¾ˆå¤šå°ç»„ä»¶ã€‚ç»„ä»¶å¤šã€å±‚çº§æ·±ä¸€ç›´æ˜¯æ•°æ®ä¼ é€’çš„ä¸€ä¸ªç—›ç‚¹ã€‚ä»ä¼ ç»Ÿè§’åº¦çœ‹ï¼Œå¯ä»¥ä½¿ç”¨prop/emitã€vuexç­‰æ–¹å¼è§£å†³ã€‚</p>\n<p>prop/emitå¯¹äºå±‚çº§ç®€å•ã€ç»„ä»¶æ•°æ®ç®€å•çš„åœºæ™¯æ¯”è¾ƒå®ç”¨ï¼Œä¸€æ—¦å±‚çº§å¤æ‚æˆ–è€…å‡ºç°å…„å¼Ÿç­‰åœºæ™¯å®ç°æ—¶å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚\nvuexå¯ä»¥è¯´æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸‡é‡‘æ²¹çš„æ–¹æ¡ˆï¼Œæ•°æ®æ”¾è¿›å»ã€æ–¹æ³•å®šä¹‰å¥½å°±è¡Œã€‚vuexä¹Ÿæ˜¯optionså®šä¹‰çš„æ–¹å¼ï¼Œæ¨¡æ¿å½¢å¼å¤ªå¼ºï¼Œä¸”åŸºæœ¬ä¸æ”¯æŒTSç±»å‹ç³»ç»Ÿã€‚</p>\n<p>ç°åœ¨æœ‰äº†CompositionApiï¼Œå¯ä»¥ä½¿ç”¨<code class=\"language-text\">ref</code>/<code class=\"language-text\">reactive</code>ä»¥åŠ<code class=\"language-text\">provide</code>/<code class=\"language-text\">inject</code>æ¥ä¼ é€’ç®¡ç†æ•°æ®äº†ã€‚é…åˆTSç±»å‹ç³»ç»Ÿä½“éªŒæ›´ä½³ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨çš„ğŸŒ°ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// æ•°æ®é€»è¾‘éƒ¨åˆ†</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">KEY</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">initData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> ref<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// dataä¸ºç»„ä»¶å†…éƒ¨å…±äº«çš„æ•°æ®</span>\n  <span class=\"token function\">provide</span><span class=\"token punctuation\">(</span><span class=\"token constant\">KEY</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token constant\">KEY</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> ref<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span>\n  <span class=\"token keyword\">const</span> methodWithData<span class=\"token operator\">:</span> <span class=\"token function-variable function\">XxType</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// data.value ç›¸å…³çš„æ“ä½œé€»è¾‘ä»£ç </span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> methodWithData <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// çˆ¶ç»„ä»¶</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">initData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// å­å­™ç»„ä»¶</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> methodWithData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// methodWithData()</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>TODO: å…¶ä»–å†…å®¹æŒç»­è¡¥å……ä¸­ã€‚</p>\n</blockquote>","fields":{"slug":"/posts/vue-composition-api","tagSlugs":["/tag/vue/","/tag/composition-api/"]},"frontmatter":{"date":"2020-06-04 22:00","description":"Vue3ç‰ˆæœ¬æ¨å‡ºåœ¨å³ï¼Œä¸ºäº†è®©å¹¿å¤§ç”¨æˆ·æå‰æ„Ÿå—æ–°ç‰ˆç‰¹æ€§ï¼ŒVueå®˜æ–¹æ¨å‡ºäº†å…¼å®¹Vue2çš„@vue/composition-apiåº“ã€‚è¿™é‡Œç®€å•è®°å½•ä¸‹è¿‘åŠå¹´çš„ä½¿ç”¨æ”¶è·ã€‚","tags":["vue","composition-api"],"title":"Vue2 & CompositionApi","socialImage":""}}},"pageContext":{"slug":"/posts/vue-composition-api"}}}