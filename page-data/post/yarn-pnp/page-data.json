{"componentChunkName":"component---src-templates-page-js","path":"/post/yarn-pnp/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Yarn PnP","date":"15 February 2020","path":"/post/yarn-pnp/","author":"Suyi","excerpt":"2020年1月下旬，Node包管理工具Yarn推出了2.0版本。1.12版本开始加入的PnP功能默认包含。","tags":["Yarn"],"coverImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAP/xAAVAQEBAAAAAAAAAAAAAAAAAAABBP/aAAwDAQACEAMQAAABqmojBP/EABYQAQEBAAAAAAAAAAAAAAAAAAECIP/aAAgBAQABBQKAWgHH/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAIhIP/aAAgBAQAGPwKkbP8A/8QAGhAAAgIDAAAAAAAAAAAAAAAAAREAISBRYf/aAAgBAQABPyEg5oNOFlmqx//aAAwDAQACAAMAAAAQzN//xAAWEQEBAQAAAAAAAAAAAAAAAAARARD/2gAIAQMBAT8QYBn/xAAWEQEBAQAAAAAAAAAAAAAAAAARECH/2gAIAQIBAT8QNZ//xAAcEAEBAAAHAAAAAAAAAAAAAAABEQAgIUFRgZH/2gAIAQEAAT8QPk6UApeX3ATALuXvL//Z","aspectRatio":1.9555555555555555,"src":"/static/a364689085220ed90f6f39067fe01d6c/b17c1/yarn.jpg","srcSet":"/static/a364689085220ed90f6f39067fe01d6c/00e5e/yarn.jpg 200w,\n/static/a364689085220ed90f6f39067fe01d6c/1a903/yarn.jpg 400w,\n/static/a364689085220ed90f6f39067fe01d6c/b17c1/yarn.jpg 800w,\n/static/a364689085220ed90f6f39067fe01d6c/2f073/yarn.jpg 1200w,\n/static/a364689085220ed90f6f39067fe01d6c/48ee2/yarn.jpg 1600w,\n/static/a364689085220ed90f6f39067fe01d6c/af500/yarn.jpg 2200w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"id":"1c81be53-99b7-53e1-b444-060469f03538","html":"<p>2020年1月下旬，Node包管理工具Yarn推出了2.0版本。1.12版本开始加入的PnP功能默认包含。</p>\n<h2>历史</h2>\n<p>随着前端领域的飞速发展，前端的库越来越多。为了更好地管理各种各样的库，Nodejs推出了官方的包管理工具npm。</p>\n<p>在npm5之前，npm cli使用体检不佳:</p>\n<ol>\n<li>没有依赖锁定使得不同环境安装可能会出现版本冲突；</li>\n<li>没有本地离线缓存功能，无网环境下会安装失败；</li>\n<li>依赖安装比较慢。</li>\n</ol>\n<blockquote>\n<p>npm5起加入了版本锁定等功能，提高了依赖安装速度。</p>\n</blockquote>\n<p>因为npm存在的这些问题，Yarn横空出世，给npm依赖的安装管理带来了便利的交互和更快的速度等。</p>\n<h2>Yarn 2</h2>\n<p>因为<code class=\"language-text\">(感谢)</code>yarn的存在，npm改进了自身cli的体验，加入了版本锁定等提升安装速度的特性。现在日常使用中npm、yarn两者安装的速度已经相差无几。</p>\n<p>但是，node项目始终存在问题——依赖目录<code class=\"language-text\">node_modules</code>过重。占用过大、文件过多，安装过程中IO开销过大。</p>\n<blockquote>\n<ol>\n<li>一个同事的Windows电脑，磁盘速度不快。出现问题时删除项目的<code class=\"language-text\">node_modules</code>花费了10分钟(基本每次都是喝杯茶回来才好)。</li>\n<li><code class=\"language-text\">node_modules</code>目录太复杂，且文件又多又小，比较吃磁盘。</li>\n</ol>\n</blockquote>\n<p>来自yarn官方对于node包解析低效的原因说明:</p>\n<blockquote>\n<ul>\n<li><code class=\"language-text\">node_modules</code>目录通常包含了大量的文件，<code class=\"language-text\">yarn install</code>时可能会花超过70%的时间生成它们。由于包管理工具依然会将已存在的<code class=\"language-text\">node_modules</code>和期待结果进行diff，所以即便之前已经执行过install操作也无法挽救。</li>\n<li>因为<code class=\"language-text\">node_modules</code>的生成是IO密集操作，包管理工具除了做简单的文件拷贝(甚至在可能时，可以使用硬链接或者<code class=\"language-text\">copy-on-write</code>技术)之外没有其他办法更好的优化方法，仍需在操作磁盘的大量系统调用前diff文件差异。</li>\n<li>因为Node没有包的概念，它也不知道文件是否<code class=\"language-text\">应该</code>被访问(<code class=\"language-text\">与其相对的是被标记表示需要使用</code>)。完全可能出现这样的场景，因为忘记在<code class=\"language-text\">package.json</code>中列举了部分依赖导致开发环境可用的代码在生产环境出现问题。</li>\n<li>甚至在运行时，Node的解析机制需要大量的<code class=\"language-text\">stat</code>和<code class=\"language-text\">readdir</code>系统调用去计算每个被require的文件的路径位置。这是极其浪费的，也是Node应用启动耗时长的部分原因。</li>\n<li>最后，<code class=\"language-text\">node_modules</code>目录不支持包管理工具合理扁平处理包文件结构，这一设计是不切实际的。即使有些算法可以拿来优化依赖树的结构，但依旧不能优化一些特定的场景——不仅导致了文件磁盘占用比预期高，也使得一些包在内存中被实例化多次。</li>\n</ul>\n<p><em>Ps</em> <code class=\"language-text\">versus being available by the sheer virtue of hoisting</code> => 不理解，就翻译成了<code class=\"language-text\">与其相对的是被标记表示需要使用</code></p>\n</blockquote>\n<p>例1:\n以<code class=\"language-text\">create-react-app</code>为例，一行代码未写，已经占用了<code class=\"language-text\">188MB</code>。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 770px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7cc7c92a61a49874930d1cbe749284a/94f2c/create-react-app.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.22077922077922%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcuFkB//xAAVEAEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAQABBQKv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFhABAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAEBAAE/IXLn/9oADAMBAAIAAwAAABAP/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAAcAAAAAAAAAAAAAAAABABARMUFRcf/aAAgBAQABPxBXRTIQq5Xsv//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create react app\"\n        title=\"create react app\"\n        src=\"/static/b7cc7c92a61a49874930d1cbe749284a/94f2c/create-react-app.jpg\"\n        srcset=\"/static/b7cc7c92a61a49874930d1cbe749284a/40c5d/create-react-app.jpg 200w,\n/static/b7cc7c92a61a49874930d1cbe749284a/b94fa/create-react-app.jpg 400w,\n/static/b7cc7c92a61a49874930d1cbe749284a/94f2c/create-react-app.jpg 770w\"\n        sizes=\"(max-width: 770px) 100vw, 770px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>例2:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0008f169794a833b9714a5f519325134/0bfdd/node_modules.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHdhUlDF//EABoQAAEFAQAAAAAAAAAAAAAAAAEAAgMRMTL/2gAIAQEAAQUCNKgm5LjOBn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAARAh/9oACAEBAAY/AtiiEf/EAB0QAAICAQUAAAAAAAAAAAAAAAABETGhIUFxgZH/2gAIAQEAAT8hVrR2LS3lGEU8i+RjH//aAAwDAQACAAMAAAAQjw//xAAVEQEBAAAAAAAAAAAAAAAAAAABAP/aAAgBAwEBPxBIv//EABURAQEAAAAAAAAAAAAAAAAAAAEA/9oACAECAQE/EBm//8QAHRABAQEAAQUBAAAAAAAAAAAAAREAITFBUXGhsf/aAAgBAQABPxCIxHoOqHFKo8PTACPDAtCnBwUhe7fM/N//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"node modules\"\n        title=\"node modules\"\n        src=\"/static/0008f169794a833b9714a5f519325134/3a0b5/node_modules.jpg\"\n        srcset=\"/static/0008f169794a833b9714a5f519325134/40c5d/node_modules.jpg 200w,\n/static/0008f169794a833b9714a5f519325134/b94fa/node_modules.jpg 400w,\n/static/0008f169794a833b9714a5f519325134/3a0b5/node_modules.jpg 800w,\n/static/0008f169794a833b9714a5f519325134/0bfdd/node_modules.jpg 1000w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>为了解决<code class=\"language-text\">node_modules</code>目录存在的问题，Yarn正式推出了Yarn 2，加入了pnp(<code class=\"language-text\">Plug&#39;n&#39;Play</code>)功能。</p>\n<h3>PnP</h3>\n<p>PnP，<code class=\"language-text\">Plug&#39;n&#39;Play</code>的缩写，意为即插即用。</p>\n<p>启用PnP后(Yarn 2默认启用)，<code class=\"language-text\">yarn install</code>不再生成<code class=\"language-text\">node_modules</code>目录，而是生成了<code class=\"language-text\">.yarn</code>目录和<code class=\"language-text\">.pnp.js</code>文件。</p>\n<p><code class=\"language-text\">.yarn</code>目录存放了项目中下载的所有依赖的zip包，<code class=\"language-text\">.pnp.js</code>的内容是项目的npm模块解析规则。</p>\n<h4>使用🌰</h4>\n<p>下面以本地安装并console.log<code class=\"language-text\">ramda</code>为例。</p>\n<ol>\n<li>新建项目，加入依赖<code class=\"language-text\">ramda</code></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"ramda\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^0.27.0\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>yarn install</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/485bbfaee9f6bddebf84bc020f0ebb67/c92e5/yarn-install.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.215155615696887%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcySwD//xAAVEAEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAQABBQJv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABPyF//9oADAMBAAIAAwAAABCMP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABkQAAMAAwAAAAAAAAAAAAAAAAABEUFxkf/aAAgBAQABPxBo5guuFP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"yarn install\"\n        title=\"yarn install\"\n        src=\"/static/485bbfaee9f6bddebf84bc020f0ebb67/3a0b5/yarn-install.jpg\"\n        srcset=\"/static/485bbfaee9f6bddebf84bc020f0ebb67/40c5d/yarn-install.jpg 200w,\n/static/485bbfaee9f6bddebf84bc020f0ebb67/b94fa/yarn-install.jpg 400w,\n/static/485bbfaee9f6bddebf84bc020f0ebb67/3a0b5/yarn-install.jpg 800w,\n/static/485bbfaee9f6bddebf84bc020f0ebb67/1fd70/yarn-install.jpg 1200w,\n/static/485bbfaee9f6bddebf84bc020f0ebb67/c92e5/yarn-install.jpg 1478w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 404px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/979170bd67d246cb1be33141eb0097c8/a5aa3/yarn-install-folder.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 112.37623762376236%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAWABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHsZcpTROFlA//EABgQAAIDAAAAAAAAAAAAAAAAAAABEBEh/9oACAEBAAEFAmIoYtjSnH//xAAVEQEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAwEBPwEj/8QAFREBAQAAAAAAAAAAAAAAAAAAESD/2gAIAQIBAT8BY//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CH//EABwQAAIDAAMBAAAAAAAAAAAAAAABESExEEGBof/aAAgBAQABPyFexljd8MGlvxsiByyBTW/rLP/aAAwDAQACAAMAAAAQ1/j/AP/EABcRAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQMBAT8QgiLn/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EJVbWMf/xAAeEAEAAgEEAwAAAAAAAAAAAAABABEhMUFhsYGR8P/aAAgBAQABPxCko0DnNY9S6mo1qr1KTWNk5OoQpu+WYUUL5bhwbDunUFbFxJeE/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"yarn install folder\"\n        title=\"yarn install folder\"\n        src=\"/static/979170bd67d246cb1be33141eb0097c8/a5aa3/yarn-install-folder.jpg\"\n        srcset=\"/static/979170bd67d246cb1be33141eb0097c8/40c5d/yarn-install-folder.jpg 200w,\n/static/979170bd67d246cb1be33141eb0097c8/b94fa/yarn-install-folder.jpg 400w,\n/static/979170bd67d246cb1be33141eb0097c8/a5aa3/yarn-install-folder.jpg 404w\"\n        sizes=\"(max-width: 404px) 100vw, 404px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol start=\"3\">\n<li>yarn run test</li>\n</ol>\n<blockquote>\n<p>在package.json中定义\"test\"</p>\n<p>\"test\" => \"node -e 'console.log(require(\"ramda\"))'\"</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 764px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b83d600848e018522848d70484a41fa/aa9ea/yarn-run-script.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.5392670157068%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABzaNVZAB//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFhABAQEAAAAAAAAAAAAAAAAAARAR/9oACAEBAAE/IXa3/9oADAMBAAIAAwAAABDL/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAACAgMBAAAAAAAAAAAAAAABEQAxECFRgf/aAAgBAQABPxAE2d8UNlp+4oYbOP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"yarn run script\"\n        title=\"yarn run script\"\n        src=\"/static/7b83d600848e018522848d70484a41fa/aa9ea/yarn-run-script.jpg\"\n        srcset=\"/static/7b83d600848e018522848d70484a41fa/40c5d/yarn-run-script.jpg 200w,\n/static/7b83d600848e018522848d70484a41fa/b94fa/yarn-run-script.jpg 400w,\n/static/7b83d600848e018522848d70484a41fa/aa9ea/yarn-run-script.jpg 764w\"\n        sizes=\"(max-width: 764px) 100vw, 764px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>不能直接使用<code class=\"language-text\">node xxx.js</code>，因为node依赖解析的目录<code class=\"language-text\">node_modules</code>没了。</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f18f87e84dd9c396e36ea97ce9bc8695/7fcd5/node-run-script.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.65371024734982%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHMm5sQg//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAAEFAAAAAAAAAAAAAAAAABAAARFxgf/aAAgBAQABPyGbWlx//9oADAMBAAIAAwAAABDM/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEAAQQDAAAAAAAAAAAAAAABEQAQITFBUZH/2gAIAQEAAT8QZAz6pnlW0EdU3Gbf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"node run script\"\n        title=\"node run script\"\n        src=\"/static/f18f87e84dd9c396e36ea97ce9bc8695/3a0b5/node-run-script.jpg\"\n        srcset=\"/static/f18f87e84dd9c396e36ea97ce9bc8695/40c5d/node-run-script.jpg 200w,\n/static/f18f87e84dd9c396e36ea97ce9bc8695/b94fa/node-run-script.jpg 400w,\n/static/f18f87e84dd9c396e36ea97ce9bc8695/3a0b5/node-run-script.jpg 800w,\n/static/f18f87e84dd9c396e36ea97ce9bc8695/7fcd5/node-run-script.jpg 1132w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4>其他说明</h4>\n<ol>\n<li>\n<p>PnP的依赖变成了zip包，可以上传VCS。开发、编译环境的依赖包可以做到完全一致，也可以省去安装的时间。</p>\n<p><a href=\"https://github.com/yarnpkg/berry\">yarn官方仓库</a>就使用了这种方式管理依赖。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 628px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/90735e572640f56d9c6452a3ea8d4fb7/37cdf/yarn-berry-repo.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.54140127388536%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBQL/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB7nVlMpsCuAsC/wD/xAAaEAACAgMAAAAAAAAAAAAAAAAAAQIUEBEx/9oACAEBAAEFAqbKLKUjhsRLCP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABgQAAMBAQAAAAAAAAAAAAAAAAABMpEQ/9oACAEBAAY/AqWFrC1gurv/xAAcEAACAgIDAAAAAAAAAAAAAAAAARARITFBUXH/2gAIAQEAAT8hTKXDBlQ3adqLjNrJp4jU/9oADAMBAAIAAwAAABCsOPz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8QK//EAB4QAAMAAQQDAAAAAAAAAAAAAAABESFBcZHRYbHx/9oACAEBAAE/EFal2rb0PuuxYCbu3YzRYhTyrgoIMtga8nvP/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"yarn berry repo\"\n        title=\"yarn berry repo\"\n        src=\"/static/90735e572640f56d9c6452a3ea8d4fb7/37cdf/yarn-berry-repo.jpg\"\n        srcset=\"/static/90735e572640f56d9c6452a3ea8d4fb7/40c5d/yarn-berry-repo.jpg 200w,\n/static/90735e572640f56d9c6452a3ea8d4fb7/b94fa/yarn-berry-repo.jpg 400w,\n/static/90735e572640f56d9c6452a3ea8d4fb7/37cdf/yarn-berry-repo.jpg 628w\"\n        sizes=\"(max-width: 628px) 100vw, 628px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>因为PnP、Yarn才刚推出不久，不推荐项目直接升级。</li>\n<li>\n<p>前端社区其他工具链支持度还不够，从官方看已有下列的工具有条件支持(某版本起或插件支持)。</p>\n<blockquote>\n<p>来自<a href=\"https://yarnpkg.com/features/pnp#caveats-and-work-in-progress\">yarn官方站说明</a>。</p>\n<p>Babel</p>\n<p>Create-React-App</p>\n<p>ESLint</p>\n<p>Husky</p>\n<p>Jest</p>\n<p>Prettier</p>\n<p>Rollup</p>\n<p>TypeScript-ESLint</p>\n<p>WebStorm</p>\n<p>TypeScript</p>\n<p>VSCode-ESLint</p>\n<p>VSCode</p>\n<p>Webpack</p>\n</blockquote>\n</li>\n</ol>\n<h2>总结</h2>\n<p>yarn pnp的出现给前端工程角度带来了新的方向，值得尝试和探索。</p>\n<p>对个人开发者来说可能影响不大，但是团队、公司层面的项目需要慎重，可以尝鲜，不建议直接切换。</p>\n<p>另外，前端又有新玩具玩了😁。</p>\n<h2>参考</h2>\n<ol>\n<li><a href=\"https://yarnpkg.com/features/pnp\">yarn pnp介绍</a></li>\n</ol>","excerpt":"2020年1月下旬，Node包管理工具Yarn推出了2.0版本。1.12版本开始加入的PnP功能默认包含。 历史 随着前端领域的飞速发展，前端的库越来越多。为了更好地管理各种各样的库，Nodejs推出了官方的包管理工具npm。 在npm5之前，npm cli…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":"/post/2020-go/","title":"起航2020","tags":null},"fileAbsolutePath":"/home/travis/build/suyi91/suyi91.github.io/src/posts/2020-02-03---2020-go/index.md"},"previous":null}}}