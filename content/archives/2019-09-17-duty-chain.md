---
title: JavaScriptä¸­çš„èŒè´£é“¾æ¨¡å¼
author: Suyi
authorURL: https://github.com/suyi91
authorFBID: 100009224056265
---

## ç®€ä»‹

èŒè´£é“¾æ¨¡å¼çš„å®šä¹‰æ˜¯ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œå°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚

èŒè´£é“¾æ¨¡å¼çš„åå­—éå¸¸å½¢è±¡ï¼Œä¸€ç³»åˆ—å¯èƒ½ä¼šå¤„ç†è¯·æ±‚çš„å¯¹è±¡è¢«è¿æ¥æˆä¸€æ¡é“¾ï¼Œè¯·æ±‚åœ¨è¿™äº›å¯¹è±¡ä¹‹é—´ä¾æ¬¡ä¼ é€’ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ªå¯ä»¥å¤„ç†å®ƒçš„å¯¹è±¡ï¼ŒæŠŠè¿™äº›å¯¹è±¡ç§°ä¸ºé“¾ä¸­çš„èŠ‚ç‚¹ã€‚

![chain](https://i.loli.net/2019/09/17/cVhmHiXlge3vWGO.jpg)

<!--truncate-->

## Example

æ€è·¯æ¥è‡ª[JavaScriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µ](https://book.douban.com/subject/26382780/)

ä¸€ä¸ªå¤æ‚å·¥å•æäº¤å•æ®å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œå¤„ç†ï¼š

1. æ£€æŸ¥è½¦ä¸»ä¿¡æ¯ï¼Œæ˜¯å¦æ­£ç¡®å¡«å†™ï¼›
1. æ£€æŸ¥å•æ®åŸºæœ¬ä¿¡æ¯ï¼Œæ˜¯å¦éƒ½æ­£ç¡®å¡«å†™ï¼›
1. æ£€æŸ¥é¡¹ç›®åˆ—è¡¨æ˜ç»†ï¼Œæ˜¯å¦éƒ½æ­£ç¡®å¡«å†™ï¼›
1. æ£€æŸ¥ææ–™åˆ—è¡¨æ˜ç»†ï¼Œæ˜¯å¦éƒ½æ­£ç¡®å¡«å†™ï¼›
1. ...
1. æäº¤æ•°æ®

æ£€æŸ¥éƒ½é€šè¿‡åï¼Œå¤„ç†æ•°æ®æäº¤å•æ®ã€‚

ä¸€èˆ¬çš„å†™æ³•å°±æ˜¯åœ¨checkæ–¹æ³•ä¸­ä¸€å †çš„if elseï¼›ç¨å¾®æ”¹è¿›ä¸€äº›çš„æ–¹æ³•æ˜¯ï¼Œæ ¹æ®ä¸Šé¢çš„åˆ—è¡¨é¡ºåºåˆ†åˆ«å®šä¹‰checkæ–¹æ³•æ‰§è¡Œã€‚

å¯¹äºif elseçš„æ–¹å¼ï¼Œä¸šåŠ¡å¤æ‚æ—¶ä»£ç é‡è¿‡å¤§ï¼Œå‡ºç°ä¸šåŠ¡å˜åŠ¨æ—¶æ”¹åŠ¨å¯èƒ½æ¯”è¾ƒç—›è‹¦ï¼›å¹¶ä¸”ï¼ŒåŒä¸€ä¸ªå‡½æ•°åŸŸå†…å¯èƒ½éœ€è¦å®šä¹‰è¾ƒå¤šçš„ä¸­é—´å˜é‡ã€‚

å¯¹äºæå–æ¯ä¸ªæ­¥éª¤çš„checkæ–¹æ³•çš„æ–¹å¼ï¼Œåœ¨ç›¸é‚»æ£€æŸ¥æ­¥éª¤çš„å¤„ç†ä¸­å¯èƒ½å­˜åœ¨å…³è”è°ƒç”¨çš„æƒ…å†µâ€”â€”æ­¥éª¤1é€šè¿‡åè°ƒç”¨æ­¥éª¤2ã€æ­¥éª¤2é€šè¿‡åè°ƒç”¨æ­¥éª¤3ç­‰ç­‰â€”â€”å½“å‡ºç°æ·»åŠ ã€åˆ é™¤ç¯èŠ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¸å¤Ÿçµæ´»(ä¹Ÿè¿åå¼€é—­åŸåˆ™)ã€‚

----

## ä½¿ç”¨èŒè´£é“¾æ¨¡å¼çš„å®ç°

### å®šä¹‰Chainé“¾èŠ‚ç‚¹æ„é€ å‡½æ•°

```ts
export default class Chain {
  /** å½“å‰èŠ‚ç‚¹å¤„ç†æ–¹æ³• */
  private fn: Function;
  /** å­˜å‚¨ä¸‹ä¸€èŠ‚ç‚¹ */
  private successor: Chain | null;

  public static readonly SuccessorKey = 'nextSuccessor';

  public constructor(fn: Function) {
    this.fn = fn;
    this.successor = null;
  }

  /**
   * è®¾ç½®ä¸‹ä¸€èŠ‚ç‚¹
   * @param successor ä¸‹ä¸€èŠ‚ç‚¹
   */
  public setNextSuccessor(successor: Chain): Chain {
    return (this.successor = successor);
  }

  public passRequest(...args: any[]): any {
    const ret = this.fn.apply(this, arguments);
    if (ret === Chain.SuccessorKey) {
      return this.successor && this.successor.passRequest.apply(this.successor, args);
    }
    return ret;
  }
}
```

### å®šä¹‰é“¾èŠ‚ç‚¹

```ts
const Chain1 = new Chain((val: any): any => (val === 1 ? val : Chain.SuccessorKey));
const Chain2 = new Chain((val: any): any => (val === 2 ? val : Chain.SuccessorKey));
const Chain3 = new Chain((val: any): any => (val === 3 ? val : Chain.SuccessorKey));
const Chain4 = new Chain((val: any): any => (val === 4 ? val : Chain.SuccessorKey));
const Chain5 = new Chain((val: any): any => (val === 5 ? val : Chain.SuccessorKey));
```

### ä¸²æ¥é“¾èŠ‚ç‚¹å¹¶æ‰§è¡Œ

```ts
Chain1.setNextSuccessor(Chain2)
      .setNextSuccessor(Chain3)
      .setNextSuccessor(Chain4)
      .setNextSuccessor(Chain5);

Chain1.passRequest(/** ä¼ å…¥å‚æ•°xx */)
```

### ä¸šåŠ¡å˜åŠ¨ï¼Œåœ¨Chain2å’ŒChain3ä¸­é—´æ’å…¥Chain2_5èŠ‚ç‚¹

```ts
const Chain2_5 = new Chain((val: any): any => (val === 2.5 ? val : Chain.SuccessorKey));

Chain2.setNextSuccessor(Chain2_5);
Chain2_5.setNextSuccessor(Chain3);
```

*__æ³¨__: åœ¨ä¸æ¸…æ¥šæ—¢å­˜ä»£ç çš„æ—¶å€™ï¼Œè¿™ç§æ”¹åŠ¨æ–¹å¼å¯èƒ½æ˜¯æœ€ä¿é™©çš„*

## å¼‚æ­¥çš„èŒè´£é“¾å®ç°

ä¸Šé¢éƒ½æ˜¯åŒæ­¥çš„èŒè´£é“¾ï¼Œé‚£ä¹ˆå¯¹äºç½‘ç»œè¯·æ±‚çš„åœºæ™¯åˆ©ç”¨èŒè´£é“¾å¦‚ä½•å®ç°å‘¢ï¼Ÿ

å¾ˆç®€å•ï¼Œç»™ChainåŠ å…¥nextæ–¹æ³•ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æ‰‹åŠ¨æ‰§è¡Œã€‚

```ts
class Chain {
  // åŸæœ‰å†…å®¹çœç•¥

  public next(...args: any): any {
    return this.successor && this.successor.passRequest.apply(this.successor, args);
  }
}
```

### Demo

```ts
const AsyncChain1 = new Chain(function(val: any): any {
  if (val === 1) return val;
  return this.next(val);
});
const AsyncChain2 = new Chain(function(val: any): any {
  if (val === 2) return val;
  return this.next(val);
});

AsyncChain1.setNextSuccessor(AsyncChain2)

AsyncChain1.passRequest(2) // 2
```

## å…¶ä»–

### è½¬åŒ–é“¾

ä»èŒè´£é“¾çš„å®šä¹‰å¯ä»¥çœ‹å‡ºï¼ŒèŒè´£é“¾çš„å…¥å‚æ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯æœ‰äº›ä¸šåŠ¡åœºæ™¯éœ€è¦åœ¨ä¸­é—´è¿›è¡Œå¤„ç†(ä¾‹å¦‚inputçš„è¾“å…¥è¿‡ç¨‹ï¼Œéœ€è¦å¯¹ä¸åˆæ³•çš„å†…å®¹è¿›è¡Œä¿®æ”¹)ã€‚

è¿™äº›åœºæ™¯ä¸‹å¯ä»¥å¯¹èŒè´£é“¾æ¨¡å‹`Chain`è¿›è¡Œæ”¹é€ ï¼Œæ‰©å±•æˆè´Ÿè´£è½¬åŒ–æ•°æ®çš„`Chain`ã€‚

```js
class TransformChain extends Chain {
  /** åŒæ­¥ç”¨ */
  passRequest(...args) {
    const newArgs = this.fn.call(this, ...args);
    return this.successor && this.successor.passRequest.call(this.successor, ...newArgs);
  }
  /** å¼‚æ­¥ç”¨ */
  next(...args) {
    const newArgs = this.fn.call(this, ...args);
    return this.successor && this.successor.passRequest.call(this.successor, ...newArgs);
  }
}
```

`Chain`å’Œ`TransformChain`ç»“åˆä½¿ç”¨ï¼Œæ•ˆæœæ›´ä½³ã€‚ğŸ˜
